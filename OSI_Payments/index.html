<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–ò–ë/–û–°–ò –¢”©–ª–µ–º –ñ“Ø–π–µ—Å—ñ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>üè† –ú–ò–ë/–û–°–ò –¢”©–ª–µ–º–¥–µ—Ä–¥—ñ –ë–∞—Å“õ–∞—Ä—É –ñ“Ø–π–µ—Å—ñ (–ê–≤—Ç–æ–Ω–æ–º–¥—ã)</h1>
    </header>

    <main>
        <section class="controls">
            <h2>–ï—Å–µ–ø—Ç–µ—É–¥—ñ –ë–∞—Å—Ç–∞—É</h2>
            <div class="input-group">
                <label for="calc-month">–ê–π:</label>
                <select id="calc-month">
                    </select>
                <label for="calc-year">–ñ—ã–ª:</label>
                <input type="number" id="calc-year" value="2025" min="2020" max="2030">
                <button id="calculate-btn">–ê–π–ª—ã“õ –¢”©–ª–µ–º–¥—ñ –ï—Å–µ–ø—Ç–µ—É</button>
            </div>
            <p id="message" class="status-message"></p>

            <hr style="margin: 20px 0;">
            
            <h2>–ñ—ã–ª–¥—ã“õ –ï—Å–µ–ø –ë–µ—Ä—É</h2>
            <div class="input-group">
                <label for="report-flat-number">–ü”ô—Ç–µ—Ä ‚Ññ:</label>
                <input type="number" id="report-flat-number" placeholder="–ü”ô—Ç–µ—Ä ‚Ññ" min="1">
                <label for="report-year">–ñ—ã–ª:</label>
                <input type="number" id="report-year" value="2025" min="2020" max="2030">
                <button id="generate-report-btn">–ï—Å–µ–ø—Ç—ñ –ö”©—Ä—Å–µ—Ç—É</button>
            </div>

            <hr style="margin: 20px 0;">

            <h2>–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –ë–∞—Å“õ–∞—Ä—É (CSV)</h2>
            <div class="input-group">
                <label for="apart-file">–ü”ô—Ç–µ—Ä–ª–µ—Ä (apartments.csv):</label>
                <input type="file" id="apart-file" accept=".csv">
                <button id="import-apart-btn">–ò–º–ø–æ—Ä—Ç—Ç–∞—É</button>
                <button id="export-apart-btn">–≠–∫—Å–ø–æ—Ä—Ç—Ç–∞—É</button>
            </div>
            <p id="io-message" class="status-message"></p>
        </section>

        <section class="results">
            <h2>–ï—Å–µ–ø—Ç–µ—É –ù”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ</h2>
            <div class="table-container">
                <table id="charges-table">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th>–ü”ô—Ç–µ—Ä ‚Ññ</th>
                            <th>–ê–ª–∞“£—ã (–º¬≤)</th>
                            <th>–ñ”®–ê (—Ç–≥)</th>
                            <th>–¶–° (—Ç–≥)</th>
                            <th>–ñ–∏—ã–Ω—Ç—ã“õ (—Ç–≥)</th>
                            <th>“ö–∞—Ä—ã–∑/–ê—Ä—Ç—ã“õ —Ç”©–ª–µ–º (—Ç–≥)</th>
                            <th>–¢”©–ª–µ—É–≥–µ –∂–∞—Ç–∞–¥—ã (—Ç–≥)</th>
                            <th>”ò—Ä–µ–∫–µ—Ç</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </section>
        
        <section class="receipt print-only" id="receipt-area">
            </section>

    </main>
    
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>–¢”©–ª–µ–º–¥—ñ –¢—ñ—Ä–∫–µ—É</h3>
            <p><strong>–ü”ô—Ç–µ—Ä ‚Ññ:</strong> <span id="modal-flat-number"></span></p>
            <p><strong>–¢”©–ª–µ—É–≥–µ –∂–∞—Ç–∞–¥—ã:</strong> <span id="modal-amount-due"></span></p>

            <div class="input-group" style="flex-direction: column; align-items: flex-start;">
                <label for="modal-paid-amount">–¢”©–ª–µ–Ω–≥–µ–Ω —Å–æ–º–∞:</label>
                <input type="number" id="modal-paid-amount" placeholder="0.00" min="0" style="width: 100%; margin-top: 5px;">
                <label for="modal-payment-date">–¢”©–ª–µ–º –∫“Ø–Ω—ñ:</label>
                <input type="date" id="modal-payment-date" style="width: 100%; margin-top: 5px;">
            </div>

            <button id="record-payment-btn" style="margin-top: 20px; width: 100%;">–¢—ñ—Ä–∫–µ—É</button>
            <p id="modal-message" class="status-message" style="margin-top: 10px;"></p>
        </div>
    </div>

    <script type="module">
        // –ë–∞—Ä–ª—ã“õ –∏–º–ø–æ—Ä—Ç—Ç–∞—Ä
        import { openDB, initializeTariffs, recordPayment, getApartmentByNumber } from './db.js';
        import { calculateMonthlyCharges } from './calculator.js';
        import { importApartments, exportData, STORE_APARTMENTS } from './data-io.js';
        import { generateReceipt } from './receipt-generator.js';
        import { generateYearlyReport } from './yearly-report.js';

        // –≠–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä–¥—ñ —Ç–∞“£–¥–∞—É
        const calculateBtn = document.getElementById('calculate-btn');
        const calcMonth = document.getElementById('calc-month'); // Select —ç–ª–µ–º–µ–Ω—Ç—ñ
        const calcYear = document.getElementById('calc-year');
        const messageDisplay = document.getElementById('message');
        const chargesTableBody = document.querySelector('#charges-table tbody');
        const apartFile = document.getElementById('apart-file');
        const importApartBtn = document.getElementById('import-apart-btn');
        const exportApartBtn = document.getElementById('export-apart-btn');
        const ioMessage = document.getElementById('io-message');
        const generateReportBtn = document.getElementById('generate-report-btn');
        const reportFlatNumberInput = document.getElementById('report-flat-number');
        const reportYearInput = document.getElementById('report-year');

        // –ú–æ–¥–∞–ª—å–¥—ã —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä
        const paymentModal = document.getElementById('payment-modal');
        const modalCloseBtn = paymentModal.querySelector('.close-btn');
        const modalFlatNumber = document.getElementById('modal-flat-number');
        const modalAmountDue = document.getElementById('modal-amount-due');
        const modalPaidAmount = document.getElementById('modal-paid-amount');
        const modalPaymentDate = document.getElementById('modal-payment-date');
        const recordPaymentBtn = document.getElementById('record-payment-btn');
        const modalMessage = document.getElementById('modal-message');

        let currentFlatToPay = null;
        let currentMonthToPay = null;
        let currentYearToPay = null;

        // –í–∞–ª—é—Ç–∞ —Ñ–æ—Ä–º–∞—Ç—ã
        const formatCurrency = (amount) => new Intl.NumberFormat('kk-KZ', {
            style: 'currency',
            currency: 'KZT',
            minimumFractionDigits: 2
        }).format(amount);

        // ************************************************************
        // –ê–π (month) —Ç–∞“£–¥–∞—É ”©—Ä—ñ—Å—ñ–Ω “õ–∞–∑–∞“õ—à–∞ –∞–π –∞—Ç–∞—É–ª–∞—Ä—ã–º–µ–Ω —Ç–æ–ª—Ç—ã—Ä—É
        // ************************************************************
        function populateMonthSelect(calcMonthSelect) {
            if (!calcMonthSelect) {
                console.error("“ö–∞—Ç–µ: calc-month —Ç–∞“£–¥–∞—É —ç–ª–µ–º–µ–Ω—Ç—ñ —Ç–∞–±—ã–ª–º–∞–¥—ã.");
                return; // –ï–≥–µ—Ä —ç–ª–µ–º–µ–Ω—Ç —Ç–∞–±—ã–ª–º–∞—Å–∞, –∂“±–º—ã—Å—Ç—ã —Ç–æ“õ—Ç–∞—Ç—É
            }

            // “ö–∞–∑–∞“õ—à–∞ –∞–π –∞—Ç–∞—É–ª–∞—Ä—ã
            const MONTHS_KK = ["“ö–∞“£—Ç–∞—Ä", "–ê“õ–ø–∞–Ω", "–ù–∞—É—Ä—ã–∑", "–°”ô—É—ñ—Ä", "–ú–∞–º—ã—Ä", "–ú–∞—É—Å—ã–º", "–®—ñ–ª–¥–µ", "–¢–∞–º—ã–∑", "“ö—ã—Ä–∫“Ø–π–µ–∫", "“ö–∞–∑–∞–Ω", "“ö–∞—Ä–∞—à–∞", "–ñ–µ–ª—Ç–æ“õ—Å–∞–Ω"];
            
            // –ë“±—Ä—ã–Ω“ì—ã –æ–ø—Ü–∏—è–ª–∞—Ä–¥—ã —Ç–∞–∑–∞–ª–∞—É
            calcMonthSelect.innerHTML = ''; 

            // 1-–¥–µ–Ω 12-–≥–µ –¥–µ–π—ñ–Ω–≥—ñ –∞–π–ª–∞—Ä–¥—ã “õ–æ—Å—É
            MONTHS_KK.forEach((monthName, index) => {
                const option = document.createElement('option');
                // 'value' 1-–¥–µ–Ω –±–∞—Å—Ç–∞–ª—É—ã –∫–µ—Ä–µ–∫ (1=“ö–∞“£—Ç–∞—Ä, 12=–ñ–µ–ª—Ç–æ“õ—Å–∞–Ω)
                option.value = index + 1; 
                option.textContent = monthName;
                calcMonthSelect.appendChild(option);
            });
            
            // –ê“ì—ã–º–¥–∞“ì—ã –∞–π–¥—ã ”ô–¥–µ–ø–∫—ñ –±–æ–π—ã–Ω—à–∞ —Ç–∞“£–¥–∞—É
            const currentMonth = new Date().getMonth() + 1; // getMonth() 0-–¥–µ–Ω –±–∞—Å—Ç–∞–ª–∞–¥—ã
            calcMonthSelect.value = currentMonth;
        }
        // ************************************************************

        /**
         * –ê–π–ª—ã“õ –µ—Å–µ–ø—Ç–µ—É–¥—ñ –∂“Ø—Ä–≥—ñ–∑—É –∂”ô–Ω–µ –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä–¥—ñ –∫–µ—Å—Ç–µ–¥–µ –∫”©—Ä—Å–µ—Ç—É
         */
        async function handleCalculation() {
            messageDisplay.textContent = '–ï—Å–µ–ø—Ç–µ—É –∂“Ø—Ä–≥—ñ–∑—ñ–ª—É–¥–µ...';
            chargesTableBody.innerHTML = '';
            
            const month = parseInt(calcMonth.value);
            const year = parseInt(calcYear.value);

            try {
                const charges = await calculateMonthlyCharges(month, year);
                
                if (charges.length === 0) {
                    messageDisplay.textContent = '–ï—Å–µ–ø—Ç–µ—É “Ø—à—ñ–Ω –ø”ô—Ç–µ—Ä–ª–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã.';
                    return;
                }

                displayChargesTable(charges);
                messageDisplay.textContent = `${month} –∞–π—ã ${year} –∂—ã–ª “Ø—à—ñ–Ω –µ—Å–µ–ø—Ç–µ—É —Å”ô—Ç—Ç—ñ –∞—è“õ—Ç–∞–ª–¥—ã.`;

            } catch (error) {
                messageDisplay.textContent = `–ï—Å–µ–ø—Ç–µ—É “õ–∞—Ç–µ—Å—ñ: ${error.message}`;
                console.error(error);
            }
        }

        /**
         * –ï—Å–µ–ø—Ç–µ—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ–Ω –∫–µ—Å—Ç–µ–¥–µ –∫”©—Ä—Å–µ—Ç—É
         * @param {Array<Object>} charges - –ï—Å–µ–ø—Ç–µ–ª–≥–µ–Ω —Ç”©–ª–µ–º–¥–µ—Ä —Ç—ñ–∑—ñ–º—ñ
         */
        function displayChargesTable(charges) {
            chargesTableBody.innerHTML = '';
            charges.forEach((charge, index) => {
                const row = chargesTableBody.insertRow();
                row.insertCell().textContent = index + 1;
                row.insertCell().textContent = charge.flatNumber;
                row.insertCell().textContent = charge.sqm; // –ü”ô—Ç–µ—Ä –∞–ª–∞“£—ã
                row.insertCell().textContent = formatCurrency(charge.breakdown['–ñ”®–ê'].charge || 0);
                row.insertCell().textContent = formatCurrency(charge.breakdown['–¶–°'].charge || 0);
                row.insertCell().textContent = formatCurrency(charge.totalCharge);
                
                // “ö–∞—Ä—ã–∑/–ê—Ä—Ç—ã“õ —Ç”©–ª–µ–º
                const balanceCell = row.insertCell();
                balanceCell.textContent = formatCurrency(charge.previousBalance);
                balanceCell.style.color = charge.previousBalance > 0 ? 'red' : (charge.previousBalance < 0 ? 'green' : 'inherit');
                
                // –¢”©–ª–µ—É–≥–µ –∂–∞—Ç–∞–¥—ã
                const amountDueCell = row.insertCell();
                amountDueCell.textContent = formatCurrency(charge.amountDue);
                amountDueCell.style.fontWeight = 'bold';
                
                // ”ò—Ä–µ–∫–µ—Ç –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä—ã
                const actionCell = row.insertCell();
                
                // –¢”©–ª–µ–º –±–∞—Ç—ã—Ä–º–∞—Å—ã
                const payBtn = document.createElement('button');
                payBtn.textContent = '–¢”©–ª–µ—É';
                payBtn.className = 'pay-btn';
                payBtn.onclick = () => openPaymentModal(charge);
                actionCell.appendChild(payBtn);

                // –¢“Ø–±—ñ—Ä—Ç–µ–∫ –±–∞—Ç—ã—Ä–º–∞—Å—ã
                const receiptBtn = document.createElement('button');
                receiptBtn.textContent = '–¢“Ø–±—ñ—Ä—Ç–µ–∫';
                receiptBtn.className = 'receipt-btn';
                receiptBtn.onclick = () => generateReceipt(charge.flatNumber, charge.month, charge.year);
                actionCell.appendChild(receiptBtn);
            });
        }

        /**
         * –¢”©–ª–µ–º —Ç—ñ—Ä–∫–µ—É –º–æ–¥–∞–ª—å–¥—ã —Ç–µ—Ä–µ–∑–µ—Å—ñ–Ω –∞—à—É
         * @param {Object} chargeData - –¢”©–ª–µ–º –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ
         */
        function openPaymentModal(chargeData) {
            currentFlatToPay = chargeData.flatNumber;
            currentMonthToPay = chargeData.month;
            currentYearToPay = chargeData.year;

            modalFlatNumber.textContent = chargeData.flatNumber;
            modalAmountDue.textContent = formatCurrency(chargeData.amountDue);
            
            // ”ò–¥–µ–ø–∫—ñ –±–æ–π—ã–Ω—à–∞ —Ç”©–ª–µ–Ω—É–≥–µ —Ç–∏—ñ—Å—Ç—ñ —Å–æ–º–∞–Ω—ã –µ–Ω–≥—ñ–∑—É
            modalPaidAmount.value = chargeData.amountDue.toFixed(2); 
            // ”ò–¥–µ–ø–∫—ñ –±–æ–π—ã–Ω—à–∞ –±“Ø–≥—ñ–Ω–≥—ñ –∫“Ø–Ω–¥—ñ –µ–Ω–≥—ñ–∑—É
            modalPaymentDate.value = new Date().toISOString().substring(0, 10); 
            modalMessage.textContent = '';
            
            paymentModal.style.display = 'block';
        }
        
        /**
         * –¢”©–ª–µ–º–¥—ñ —Ç—ñ—Ä–∫–µ—É–¥—ñ –±–∞—Å“õ–∞—Ä—É
         */
        async function handleRecordPayment() {
            const flatNumber = currentFlatToPay;
            const month = currentMonthToPay;
            const year = currentYearToPay;
            const paidAmount = parseFloat(modalPaidAmount.value);
            const paymentDate = modalPaymentDate.value;
            
            if (isNaN(paidAmount) || paidAmount <= 0) {
                modalMessage.textContent = "–î“±—Ä—ã—Å —Ç”©–ª–µ–Ω–≥–µ–Ω —Å–æ–º–∞–Ω—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.";
                return;
            }
            if (!paymentDate) {
                modalMessage.textContent = "–¢”©–ª–µ–º –∫“Ø–Ω—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑.";
                return;
            }
            
            // –ï—Å–µ–ø—Ç–µ–ª–≥–µ–Ω —Å–æ–º–∞–Ω—ã “õ–∞–π—Ç–∞ –µ—Å–µ–ø—Ç–µ—É (–±–∞–ª–∞–Ω—Å ”©–∑–≥–µ—Ä—ñ—Å—ñ–Ω –∞–Ω—ã“õ—Ç–∞—É “Ø—à—ñ–Ω)
            const chargesForMonth = await calculateMonthlyCharges(month, year);
            const currentChargeData = chargesForMonth.find(c => c.flatNumber === flatNumber);
            
            if (!currentChargeData) {
                 modalMessage.textContent = `“ö–∞—Ç–µ: –ü”ô—Ç–µ—Ä ‚Ññ${flatNumber} “Ø—à—ñ–Ω –µ—Å–µ–ø—Ç–µ–ª–≥–µ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã.`;
                 return;
            }
            
            // –ë–∞–ª–∞–Ω—Å—Ç—ã“£ ”©–∑–≥–µ—Ä—É—ñ: -(–¢”©–ª–µ–Ω–≥–µ–Ω —Å–æ–º–∞ - –¢”©–ª–µ—É–≥–µ –∂–∞—Ç–∞—Ç—ã–Ω —Å–æ–º–∞)
            const balanceChange = -(paidAmount - currentChargeData.amountDue); 

            modalMessage.textContent = '–¢”©–ª–µ–º —Ç—ñ—Ä–∫–µ–ª—É–¥–µ...';
            
            try {
                // recordPayment —Ñ—É–Ω–∫—Ü–∏—è—Å—ã db.js-—Ç–µ —Ç”©–ª–µ–º–¥—ñ —Ç—ñ—Ä–∫–µ–π–¥—ñ –∂”ô–Ω–µ –ø”ô—Ç–µ—Ä –±–∞–ª–∞–Ω—Å—ã–Ω –∂–∞“£–∞—Ä—Ç–∞–¥—ã
                const newBalance = await recordPayment({
                    flatNumber: flatNumber,
                    month: month,
                    year: year,
                    paidAmount: paidAmount,
                    datePaid: paymentDate,
                }, balanceChange); 
                
                modalMessage.textContent = `–¢”©–ª–µ–º —Å”ô—Ç—Ç—ñ —Ç—ñ—Ä–∫–µ–ª–¥—ñ. –ñ–∞“£–∞ –±–∞–ª–∞–Ω—Å: ${formatCurrency(newBalance)}.`;
                
                await handleCalculation(); // –ö–µ—Å—Ç–µ–Ω—ñ –∂–∞“£–∞—Ä—Ç—É
                setTimeout(() => paymentModal.style.display = 'none', 2000);
                
            } catch (error) {
                modalMessage.textContent = `–¢”©–ª–µ–º–¥—ñ —Å–∞“õ—Ç–∞—É “õ–∞—Ç–µ—Å—ñ: ${error.message}`;
                console.error(error);
            }
        }
        
        /**
         * –ò–º–ø–æ—Ä—Ç—Ç—ã –±–∞—Å“õ–∞—Ä—É
         */
        async function handleImportApartments() {
            const file = apartFile.files[0];
            if (!file) {
                ioMessage.textContent = "–ò–º–ø–æ—Ä—Ç—Ç–∞—É “Ø—à—ñ–Ω CSV —Ñ–∞–π–ª—ã–Ω —Ç–∞“£–¥–∞“£—ã–∑.";
                return;
            }
            
            ioMessage.textContent = "–ü”ô—Ç–µ—Ä –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ –∏–º–ø–æ—Ä—Ç—Ç–∞–ª—É–¥–∞...";
            try {
                // importApartments - data-io.js-—Ç–µ–Ω
                const count = await importApartments(file);
                ioMessage.textContent = `–°”ô—Ç—Ç—ñ –∏–º–ø–æ—Ä—Ç—Ç–∞–ª–¥—ã: ${count} –∂–∞–∑–±–∞. –ë–µ—Ç—Ç—ñ –∂–∞“£–∞—Ä—Ç—É “õ–∞–∂–µ—Ç –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.`;
                await handleCalculation(); 
            } catch (error) {
                ioMessage.textContent = `–ò–º–ø–æ—Ä—Ç—Ç–∞—É “õ–∞—Ç–µ—Å—ñ: ${error.message}`;
                console.error(error);
            }
        }
        
        /**
         * –ñ—ã–ª–¥—ã“õ –µ—Å–µ–ø –±–µ—Ä—É–¥—ñ –∫”©—Ä—Å–µ—Ç—É–¥—ñ –±–∞—Å“õ–∞—Ä—É
         */
        function handleGenerateYearlyReport() {
            const flatNumber = parseInt(reportFlatNumberInput.value);
            const year = parseInt(reportYearInput.value);
            
            if (isNaN(flatNumber) || flatNumber <= 0) {
                alert("–ü”ô—Ç–µ—Ä –Ω”©–º—ñ—Ä—ñ–Ω –¥“±—Ä—ã—Å –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.");
                return;
            }
            if (isNaN(year) || year < 2020 || year > 2030) {
                alert("–ñ—ã–ª–¥—ã –¥“±—Ä—ã—Å –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.");
                return;
            }
            
            generateYearlyReport(flatNumber, year);
        }

        // ************************************************************
        // –û“õ–∏“ì–∞–ª–∞—Ä–¥—ã —Ç—ã“£–¥–∞—É—à—ã–ª–∞—Ä (Event Listeners)
        // ************************************************************

        calculateBtn.addEventListener('click', handleCalculation);
        importApartBtn.addEventListener('click', handleImportApartments);
        exportApartBtn.addEventListener('click', () => exportData(STORE_APARTMENTS));
        generateReportBtn.addEventListener('click', handleGenerateYearlyReport);
        recordPaymentBtn.addEventListener('click', handleRecordPayment);
        
        // –ú–æ–¥–∞–ª—å–¥—ã –∂–∞–±—É
        modalCloseBtn.onclick = () => { paymentModal.style.display = 'none'; };
        window.onclick = (event) => {
            if (event.target == paymentModal) {
                paymentModal.style.display = 'none';
            }
        };

        // ************************************************************
        // –ë–∞—Å—Ç–∞–ø“õ—ã —ñ—Å–∫–µ “õ–æ—Å—É (Initialization)
        // ************************************************************
        document.addEventListener('DOMContentLoaded', async () => {
            // calcMonth DOM —ç–ª–µ–º–µ–Ω—Ç—ñ–Ω populateMonthSelect —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω–∞ –∂—ñ–±–µ—Ä—É
            populateMonthSelect(calcMonth); 

            await openDB();
            await initializeTariffs();
            await handleCalculation();
        });

    </script>
</body>
</html>
