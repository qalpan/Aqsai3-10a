<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–ò–ë/–û–°–ò –¢”©–ª–µ–º –ñ“Ø–π–µ—Å—ñ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>üè† –ú–ò–ë/–û–°–ò –¢”©–ª–µ–º–¥–µ—Ä–¥—ñ –ë–∞—Å“õ–∞—Ä—É –ñ“Ø–π–µ—Å—ñ (–ê–≤—Ç–æ–Ω–æ–º–¥—ã)</h1>
    </header>

    <main>
        <!-- –ê–π —Ç–∞“£–¥–∞—É -->
        <section class="controls">
            <h2>–ï—Å–µ–ø—Ç–µ—É–¥—ñ –ë–∞—Å—Ç–∞—É</h2>
            <div class="input-group">
                <label for="calc-month">–ê–π:</label>
                <select id="calc-month"></select>
                <label for="calc-year">–ñ—ã–ª:</label>
                <input type="number" id="calc-year" value="2025" min="2020" max="2030">
                <button id="calculate-btn">–ê–π–ª—ã“õ –¢”©–ª–µ–º–¥—ñ –ï—Å–µ–ø—Ç–µ—É</button>
            </div>
            <p id="message" class="status-message"></p>
        </section>

        <!-- –ù”ô—Ç–∏–∂–µ–ª–µ—Ä -->
        <section class="results">
            <h2>–ï—Å–µ–ø—Ç–µ—É –ù”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ</h2>
            <table id="charges-table">
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>–ü”ô—Ç–µ—Ä ‚Ññ</th>
                        <th>–ê–ª–∞“£—ã (–º¬≤)</th>
                        <th>–ñ”®–ê (—Ç–≥)</th>
                        <th>–¶–° (—Ç–≥)</th>
                        <th>–ñ–∏—ã–Ω—Ç—ã“õ (—Ç–≥)</th>
                        <th>“ö–∞—Ä—ã–∑/–ê—Ä—Ç—ã“õ —Ç”©–ª–µ–º (—Ç–≥)</th>
                        <th>–¢”©–ª–µ—É–≥–µ –∂–∞—Ç–∞–¥—ã (—Ç–≥)</th>
                        <th>”ò—Ä–µ–∫–µ—Ç</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>
    </main>

    <!-- –°–∫—Ä–∏–ø—Ç -->
    <script type="module">
        import { openDB, initializeTariffs, recordPayment, getApartmentByNumber } from './db.js';
        import { calculateMonthlyCharges } from './calculator.js';
        import { importApartments, exportData, STORE_APARTMENTS } from './data-io.js';
        import { generateReceipt } from './receipt-generator.js';
        import { generateYearlyReport } from './yearly-report.js';

        const calcMonth = document.getElementById('calc-month');
        const calcYear = document.getElementById('calc-year');
        const calculateBtn = document.getElementById('calculate-btn');

        // –ê–π–ª–∞—Ä–¥—ã —Ç–æ–ª—Ç—ã—Ä—É
        function populateMonthSelect(select) {
            const MONTHS_KK = ["“ö–∞“£—Ç–∞—Ä","–ê“õ–ø–∞–Ω","–ù–∞—É—Ä—ã–∑","–°”ô—É—ñ—Ä","–ú–∞–º—ã—Ä","–ú–∞—É—Å—ã–º",
                               "–®—ñ–ª–¥–µ","–¢–∞–º—ã–∑","“ö—ã—Ä–∫“Ø–π–µ–∫","“ö–∞–∑–∞–Ω","“ö–∞—Ä–∞—à–∞","–ñ–µ–ª—Ç–æ“õ—Å–∞–Ω"];
            select.innerHTML = '';
            MONTHS_KK.forEach((m, i) => {
                const opt = document.createElement('option');
                opt.value = i + 1;
                opt.textContent = m;
                select.appendChild(opt);
            });
            select.value = new Date().getMonth() + 1;
        }

        // –ë–∞—Å—Ç–∞–ø“õ—ã —ñ—Å–∫–µ “õ–æ—Å—É
        document.addEventListener('DOMContentLoaded', async () => {
            populateMonthSelect(calcMonth);
            await openDB();
            await initializeTariffs();
        });
    </script>
</body>
</html>
