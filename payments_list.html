<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"> ¬† ¬† ¬† ¬†
<link rel="shortcut icon" href="s≈Øuretter/taÍûëba-aqsai3-10a.svg" type="image/svg">
<title>–¢”©–ª–µ–º–¥–µ—Ä –¢—ñ–∑—ñ–ª—ñ–º—ñ - Aqsai3-10a ≈Øi b√Ωrlest√Ωg√Ω</title>
<link rel='stylesheet' href='yi.css' type='text/css'/>¬†¬†

<style>
/* ... ( cabinet.html -–¥–∞“ì—ã —Å—Ç–∏–ª—å–¥–µ—Ä–¥—ñ “õ–∞–ª–¥—ã—Ä–∞–º—ã–∑ ) ... */
body {
    background-color: #f4f4f4;
}
.content-wrapper {
    max-width: 1200px; /* –¢—ñ–∑—ñ–ª—ñ–º –∫–µ“£—ñ—Ä–µ–∫ –±–æ–ª—É—ã “Ø—à—ñ–Ω */
    margin: 40px auto;
    padding: 30px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}
.payment-history-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 0.9em; /* –ö—ñ—à—ñ—Ä–µ–∫ —à—Ä–∏—Ñ—Ç —Ç—ñ–∑—ñ–ª—ñ–º “Ø—à—ñ–Ω */
}
.payment-history-table th, .payment-history-table td {
    border: 1px solid #ddd;
    padding: 10px 8px;
    text-align: left;
}
.payment-history-table th {
    background-color: #007bff;
    color: white;
    text-align: center;
}
.payment-history-table tr:nth-child(even) {
    background-color: #f9f9f9;
}
.status-paid { color: green; font-weight: bold; }
.status-pending { color: orange; font-weight: bold; }
</style>
</head>

<body>
<ul class="belgi" href="https://qalpan.github.io/Aqsai3-10a/">
<img src="s≈Øuretter/jazyu-Aqsai3-10a yi birlestigi.svg" alt="–ë–∞—Å—Ç—ã –±–µ—Ç" title="–ë–∞—Å—Ç—ã –±–µ—Ç–∫–µ - –æ—Ä–∞–ª—ã—É" data-image="s≈Øuretter/jazyu-Aqsai3-10a yi birlestigi.svg" data-description="–±–∞—Å—Ç–∞—É">
</ul>

<ul class="injener">
    <a><strong>–ò–Ω–∂–µ–Ω–µ—Ä–ª—ñ–∫ –∂–µ–ª—ñ–ª–µ—Ä–≥–µ “õ—ã–∑—ã–º–µ—Ç</strong></a>
    <a href="tel:+7 700 740 0005">+7 700 740 0005 operator</a>
    <a href="tel:+7 747 921 5140¬† tel:+7 705 765 1170">+7 747 921 5140¬† +7 705 765 1170 santex</a>
</ul>

<div class="content-wrapper">
    <h2 id="page-title">–¢”©–ª–µ–º–¥–µ—Ä –¢—ñ–∑—ñ–ª—ñ–º—ñ</h2>
    <hr>
    
    <div id="status-filter" style="margin-bottom: 20px;">
        <label for="filter-select">–ú”ô—Ä—Ç–µ–±–µ –±–æ–π—ã–Ω—à–∞ —Å“Ø–∑—É:</label>
        <select id="filter-select" onchange="filterTable()">
            <option value="all">–ë–∞—Ä–ª—ã“ì—ã</option>
            <option value="Paid">–¢”©–ª–µ–Ω–≥–µ–Ω–¥–µ—Ä</option>
            <option value="Pending">–ö“Ø—Ç—É–¥–µ–≥—ñ–ª–µ—Ä</option>
        </select>
        <span id="data-status" style="margin-left: 20px; font-weight: bold;"></span>
    </div>

    <div id="payments-list-container">
        <p>–î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ, –∫“Ø—Ç—ñ“£—ñ–∑...</p>
    </div>

</div>

<script type="text/javascript">
// --- “ö–æ—Ä“ì–∞—É —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä—ã ---
document.ondragstart = test;
document.onselectstart = test;
document.oncontextmenu = test;
function test(){return false}

// --- –¢”©–ª–µ–º –¢—ñ–∑—ñ–ª—ñ–º—ñ–Ω –ñ“Ø–∫—Ç–µ—É ---
const paymentDataUrl = '/Aqsai3-10a/payments.json'; // –ï“£ —Å–µ–Ω—ñ–º–¥—ñ –∞–±—Å–æ–ª—é—Ç—Ç—ñ –∂–æ–ª–¥—ã “õ–æ–ª–¥–∞–Ω–∞–º—ã–∑
const container = document.getElementById('payments-list-container');
const statusMessage = document.getElementById('data-status');
const filterSelect = document.getElementById('filter-select');
let allPayments = []; // –ë–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Å–∞“õ—Ç–∞—É“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω –∞–π–Ω—ã–º–∞–ª—ã

function loadPaymentsList() {
    container.innerHTML = '<p>–î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ, –∫“Ø—Ç—ñ“£—ñ–∑...</p>';
    
    fetch(paymentDataUrl) 
        .then(response => {
            if (!response.ok) { 
                throw new Error(`HTTP “õ–∞—Ç–µ—Å—ñ! –°—Ç–∞—Ç—É—Å: ${response.status}. –§–∞–π–ª–¥—ã –∂“Ø–∫—Ç–µ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.`);
            }
            return response.json();
        })
        .then(data => {
            allPayments = data;
            
            // 1. –ï“£ —Å–æ“£“ì—ã –∞–π–¥—ã –∞–Ω—ã“õ—Ç–∞—É
            const latestMonth = getLatestMonth(data);
            
            if (!latestMonth) {
                statusMessage.innerHTML = '<span style="color: red;">JSON —Ñ–∞–π–ª—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑. –î–µ—Ä–µ–∫—Ç–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã.</span>';
                container.innerHTML = `<p>–¢”©–ª–µ–º –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ —Ç–∞–±—ã–ª“ì–∞–Ω –∂–æ“õ.</p>`;
                return;
            }

            // 2. –°–æ“£“ì—ã –∞–π –±–æ–π—ã–Ω—à–∞ —Å“Ø–∑—É
            const latestData = data.filter(p => p.month === latestMonth);
            allPayments = latestData; // –§–∏–ª—å—Ç—Ä–ª–µ—É “Ø—à—ñ–Ω —Ç–µ–∫ —Å–æ“£“ì—ã –∞–π–¥—ã “õ–∞–ª–¥—ã—Ä–∞–º—ã–∑
            
            document.getElementById('page-title').innerHTML = `üí∏ –¢”©–ª–µ–º–¥–µ—Ä –¢—ñ–∑—ñ–ª—ñ–º—ñ: ${formatMonth(latestMonth)}`;
            
            renderTable(allPayments);

        })
        .catch(error => {
            console.error('–¢”©–ª–µ–º –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ:', error);
            statusMessage.innerHTML = '<span style="color: red; font-weight: bold;">–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ —à—ã“õ—Ç—ã.</span>';
            container.innerHTML = `<p style="color: red;">–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. “ö–∞—Ç–µ: ${error.message}</p>`;
        });
}

function getLatestMonth(data) {
    // –ï“£ “Ø–ª–∫–µ–Ω "YYYY-MM" –∂–æ–ª—ã–Ω —Ç–∞—É—ã–ø, —Å–æ“£“ì—ã –∞–π–¥—ã –∞–Ω—ã“õ—Ç–∞–π–¥—ã
    if (!data || data.length === 0) return null;
    return data.reduce((latest, current) => {
        return current.month > latest ? current.month : latest;
    }, data[0].month);
}

function formatMonth(monthString) {
    if (!monthString) return "–ë–µ–ª–≥—ñ—Å—ñ–∑ –∞–π";
    // “ö–∞–∑–∞“õ—à–∞ –∞–π –∞—Ç–∞—É–ª–∞—Ä—ã–Ω–∞ –∞—É–¥–∞—Ä—É–¥—ã “õ–æ—Å—É“ì–∞ –±–æ–ª–∞–¥—ã, –±—ñ—Ä–∞“õ “õ–∞–∑—ñ—Ä–≥–µ "YYYY-MM" —Ñ–æ—Ä–º–∞—Ç—ã–Ω “õ–∞–ª–¥—ã—Ä–∞–º—ã–∑
    return monthString; 
}

function renderTable(dataToRender) {
    statusMessage.innerHTML = `<span style="color: green; font-weight: bold;">${dataToRender.length} –∂–∞–∑–±–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª—É–¥–µ.</span>`;

    let html = `
        <table class="payment-history-table">
            <thead>
                <tr>
                    <th style="width: 10%;">–ü”ô—Ç–µ—Ä ‚Ññ</th>
                    <th style="width: 25%;">–°–æ–º–∞—Å—ã (—Ç–≥)</th>
                    <th style="width: 25%;">–ú”ô—Ä—Ç–µ–±–µ—Å—ñ</th>
                    <th style="width: 40%;">”ò—Ä–µ–∫–µ—Ç</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    dataToRender.forEach(payment => {
        // 'Paid' –∂”ô–Ω–µ '–¢”©–ª–µ–Ω–¥—ñ' —Å—Ç–∞—Ç—É—Å—Ç–∞—Ä—ã–Ω “õ–∞–±—ã–ª–¥–∞–π–¥—ã
        const isPaid = payment.status === '–¢”©–ª–µ–Ω–¥—ñ' || payment.status === 'Paid';
        
        const statusClass = isPaid ? 'status-paid' : 'status-pending';
        const statusText = isPaid ? '–¢”©–ª–µ–Ω–¥—ñ' : '–ö“Ø—Ç—É–¥–µ';
        
        const amountFormatted = (payment.amount || 0).toLocaleString('kk-KZ');

        html += `
            <tr>
                <td style="text-align: center;">${payment.apartment}</td>
                <td style="text-align: right;">${amountFormatted}</td>
                <td class="${statusClass}">${statusText}</td>
                <td style="text-align: center;">
                    ${payment.receipt_link ? '<a href="' + payment.receipt_link + '" target="_blank">–¢“Ø–±—ñ—Ä—Ç–µ–∫ –∫”©—Ä—É</a>' : '‚Äî'}
                    </td>
            </tr>
        `;
    });

    html += '</tbody></table>';
    container.innerHTML = html;
}

function filterTable() {
    const selectedStatus = filterSelect.value;
    let filteredList;

    if (selectedStatus === 'all') {
        filteredList = allPayments;
    } else {
        // –ï–∫—ñ —Ç—ñ–ª–¥—ñ —Å—Ç–∞—Ç—É—Å—Ç–∞—Ä–¥—ã —Å“Ø–∑—É
        filteredList = allPayments.filter(p => {
            const status = p.status.toLowerCase();
            if (selectedStatus === 'Paid') {
                return status === 'paid' || status === '—Ç”©–ª–µ–Ω–¥—ñ';
            }
            if (selectedStatus === 'Pending') {
                return status === 'pending' || status === '–∫“Ø—Ç—É–¥–µ';
            }
            return true;
        });
    }

    renderTable(filteredList);
}

// –ë–µ—Ç –∂“Ø–∫—Ç–µ–ª–≥–µ–Ω–¥–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —à–∞“õ—ã—Ä—É
window.onload = loadPaymentsList;
</script>

</body>
</html>