<!DOCTYPE html>
<html lang="kz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—É—ã—Å –±–µ—Ä—ñ—É –ø–∞—Ä–∞“ì—ã</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        /* –ñ–∞–ª–ø—ã —Å—Ç–∏–ª—å–¥–µ—Ä */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #eef1f5; 
            margin: 0;
            display: flex;
            justify-content: center;
        }
        .container { 
            background: white; 
            width: 100%;
            max-width: 900px; /* –ö”©–±—ñ—Ä–µ–∫ —Å“±—Ä–∞“õ—Ç–∞—Ä“ì–∞ –æ—Ä—ã–Ω –±–µ—Ä—É “Ø—à—ñ–Ω –µ–Ω—ñ–Ω “±–ª“ì–∞–π—Ç—Ç—ã“õ */
            padding: 8px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* –¢–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä */
        h1 {
            font-size: 18px;
            color: #2c3e50;
            font-weight: normal;
            text-align: center;
            line-height: 1.1;
        }
        h2 {
            font-size: 14px;
            color: #34495e;
            font-weight: normal;
            margin: 4px;
        }

        /* –ö—ñ—Ä—ñ—Å ”©—Ä—ñ—Å—ñ */
        #full-name { 
            width: calc(100% - 20px); 
            padding: 8px 8px; 
            margin-bottom: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
        }

        /* –°“±—Ä–∞“õ –±–ª–æ–≥—ã–Ω—ã“£ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (–∂–∞–ª–ø—ã —Å“±—Ä–∞“õ) */
        .vote-section {
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 8px;
            background-color: #f8f9fa;
        }

        /* –ù“±—Å“õ–∞–ª–∞—Ä–¥—ã “±—Å—Ç–∞–π—Ç—ã–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (“õ–æ–ª–¥–∞—É, “õ–∞—Ä—Å—ã, “õ–∞–ª—ã—Å) */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* –´“£“ì–∞–π–ª—ã, –±–µ–π—ñ–º–¥–µ–ª–µ—Ç—ñ–Ω —Ç–æ—Ä */
            gap: 8px;
        }

        /* ”ò—Ä–±—ñ—Ä –Ω“±—Å“õ–∞ –±–ª–æ–≥—ã (–º—ã—Å–∞–ª—ã, "“õ–æ–ª–¥–∞–∏–º—ã–Ω") */
        .option-block {
            background: #ffffff;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .option-text {
            font-size: 12px;
            color: #5e6062;
            font-weight: normal;
            margin-bottom: 2px;
            text-align: center;
        }

        /* Canvas - “õ–æ–ª “õ–æ—é –∞–ª–∞“£—ã */
        canvas {
            border: 1px dashed #a4b0be;
            background-color: #fff;
            cursor: crosshair;
            width: 100%; /* –ë–µ–π—ñ–º–¥–µ–ª—É “Ø—à—ñ–Ω –µ–Ω—ñ 100% */
            height: 104px; /* –¢“±—Ä–∞“õ—Ç—ã –±–∏—ñ–∫—Ç—ñ–∫ */
            display: block;
            touch-action: none; /* –°–µ–Ω—Å–æ—Ä–ª—ã —ç–∫—Ä–∞–Ω–¥–∞ —Å—ã—Ä“ì—ã—Ç—É–¥—ã ”©—à—ñ—Ä–µ–¥—ñ */
            border-radius: 4px;
        }
        
        /* –¢–∞–∑–∞–ª–∞—É –±–∞—Ç—ã—Ä–º–∞—Å—ã */
         .btn-clear {
  width: 100%;
  padding: 8px;
  background: #848180;
  color: white;
  border: none;
  cursor: pointer;
  margin-top: 4px;
  border-radius: 4px;
  font-size: 12px;
  transition: background 0.3s;
}
        .btn-clear:hover { background: #e7c50d; }

        /* –ñ—ñ–±–µ—Ä—É –±–∞—Ç—ã—Ä–º–∞—Å—ã */
       .submit-btn {
  width: 100%;
  padding: 10px;
  background: #878678;
  color: white;
  border: none;
  cursor: pointer;
  margin-top: 2px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: normal;
  transition: background 0.3s;
}
        .submit-btn:hover { background: #e7c50d; }
        
        /* –•–∞–±–∞—Ä–ª–∞–º–∞ –º”ô—Ä—Ç–µ–±–µ—Å—ñ */
        #status {
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
        }

        /* –ú–æ–±–∏–ª—å–¥—ñ “õ“±—Ä—ã–ª“ì—ã–ª–∞—Ä“ì–∞ –±–µ–π—ñ–º–¥–µ–ª—É (–µ–≥–µ—Ä —Ç–æ—Ä –±—ñ—Ä “õ–∞—Ç–∞—Ä–¥–∞ —Ç“±—Ä–º–∞—Å–∞) */
        @media (max-width: 650px) {
            .options-grid {
                grid-template-columns: 1fr; /* 650px —Ç”©–º–µ–Ω –±–æ–ª—Å–∞, –Ω“±—Å“õ–∞–ª–∞—Ä –±—ñ—Ä-–±—ñ—Ä—ñ–Ω—ñ“£ –∞—Å—Ç—ã–Ω–¥–∞ –æ—Ä–Ω–∞–ª–∞—Å–∞–¥—ã */
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìã ‚Ññ<br>–ü”ô—Ç–µ—Ä–ª–µ—Ä–¥—ñ“£, —Ç“±—Ä“ì—ã–Ω –µ–º–µ—Å “Ø–π-–∂”ô–π –º–µ–Ω—à—ñ–∫ —ñ–∏–µ–ª–µ—Ä—ñ–Ω—ñ“£ –°—ã—Ä—Ç—Ç–∞–π –¥–∞—É—ã—Å –±–µ—Ä—É –ø–∞—Ä–∞“ì—ã<br>
        –õ–∏—Å—Ç –≤ –∑–∞–æ—á–Ω–æ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –∫–≤–∞—Ä—Ç–∏—Ä, –Ω–µ–∂–∏–ª—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π</h1>
    
    <input type="text" id="full-name" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑, –ø”ô—Ç–µ—Ä, —Ç–µ–ª–µ–ø–æ–Ω‚Ññ, email - –§–∏–æ, ‚Ññ –∫–≤–∞—Ä—Ç–∏—Ä—ã, —Ç–µ–ª–æ—Ñ–æ–Ω, email" required>

    <div class="vote-section" data-question-id="q1">
        <h2>1. “Æ–∏ –∫–µ“£–µ—Å—ñ –º“Ø—à–µ–ª–µ—Ä—ñ–Ω —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å —á–ª–µ–Ω–æ–≤ –°–æ–≤–µ—Ç–∞ –¥–æ–º–∞:</h2>
        
        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:14px;">Aijan</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_aijan_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="200" height="75" data-label="1.1. Aijan - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_aijan_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="200" height="75" data-label="1.2. Aijan - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_aijan_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="200" height="75" data-label="1.3. Aijan - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
        
        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:14px;">Jangyl</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_jangyl_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="200" height="75" data-label="1.4. Jangyl - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_jangyl_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="200" height="75" data-label="1.5. Jangyl - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_jangyl_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="200" height="75" data-label="1.6. Jangyl - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>

        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:14px;">Gylnar</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_gylnar_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="200" height="75" data-label="1.7. Gylnar - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_gylnar_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="200" height="75" data-label="1.8. Gylnar - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_gylnar_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="200" height="75" data-label="1.9. Gylnar - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>

        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:14px;">Alia</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_alia_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="200" height="75" data-label="1.10. Alia - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_alia_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="200" height="75" data-label="1.11. Alia - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_alia_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="200" height="75" data-label="1.12. Alia - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
        
    </div>
    
    <div class="vote-section" data-question-id="q2">
        <h2>2. –ë–∞“õ—ã–ª–∞—É—à—ã —Ä–µ–±–∏–∑–æ—Ä —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ä–µ–≤–∏–∑–æ—Ä–∞:</h2>
            <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:14px;">Marat</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q2_marat_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="200" height="75" data-label="2.1. Marat - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q2_marat_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="200" height="75" data-label="2.2. Marat - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q2_marat_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="200" height="75" data-label="2.3. Marat - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
    </div>

    <div class="vote-section" data-question-id="q3"> 
        <h2>3. –ú–Ü–ë —Ç”©—Ä–∞“ì–∞—Å—ã–Ω —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—è –û–°–ò:</h2>
            <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:14px;">–°–µ—Ä—ñ–∫–∂–∞–Ω –¢”©–ª–µ—É“ì–∞–ª–∏“±–ª—ã –ö”©–∫–µ–±–∞–π</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q3_serikjan_za"> 
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="200" height="75" data-label="3.1. Serikjan - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q3_serikjan_protiv"> 
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="200" height="75" data-label="3.2. Serikjan - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q3_serikjan_vozderzhu"> 
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="200" height="75" data-label="3.3. Serikjan - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
    </div>


    <button class="submit-btn" id="send-btn">–ñ—ñ–±–µ—Ä—É</button>
    <p id="status"></p>
</div>

<script>
    // EMAILJS –ë–ê–ü–¢–ê–£–´ (–°—ñ–∑–¥—ñ“£ ID-—ñ“£—ñ–∑–¥—ñ –ø–∞–π–¥–∞–ª–∞–Ω–∞–º—ã–∑)
    emailjs.init("HySfhPitSDqpVM31p"); 

    const statusMsg = document.getElementById('status');
    const canvases = document.querySelectorAll('canvas');

    // –ö–∞–Ω–¥–∏–¥–∞—Ç—Ç–∞—Ä–¥—ã“£ –∞—Ç–∞—É–ª–∞—Ä—ã (–î–∞—É—ã—Å –±–µ—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã–Ω –∂–µ“£—ñ–ª–¥–µ—Ç—É “Ø—à—ñ–Ω)
    const candidates = {
        'q1': ['Aijan', 'Jangyl', 'Gylnar', 'Alia'],
        'q2': ['Marat'],
        'q3': ['–°–µ—Ä—ñ–∫–∂–∞–Ω –¢”©–ª–µ—É“ì–∞–ª–∏“±–ª—ã –ö”©–∫–µ–±–∞–π']
    };

   // ... (–±–∞—Å“õ–∞ –∫–æ–¥—Ç–∞—Ä)

    /**
     * Canvas-“õ–∞ “õ–æ–ª “õ–æ—é —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –æ—Ä–Ω–∞—Ç–∞–¥—ã. (–ñ–æ“ì–∞—Ä—ã DPI “õ–æ–ª–¥–∞—É—ã–º–µ–Ω)
     */
    function setupCanvas(canvas, clearBtn) {
        // *** 1. DPI –º–∞—Å—à—Ç–∞–±—Ç–∞—É –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ñ–Ω –∞–Ω—ã“õ—Ç–∞—É (Retina) ***
        const scale = window.devicePixelRatio || 1; 

        // –ù–∞“õ—Ç—ã —ñ—à–∫—ñ ”©–ª—à–µ–º–¥–µ—Ä (2x DPI “Ø—à—ñ–Ω)
        const displayWidth = 200;
        const displayHeight = 75;

        // *** 2. Canvas-—Ç—ã“£ –Ω–∞“õ—Ç—ã —ñ—à–∫—ñ (buffer) ”©–ª—à–µ–º–¥–µ—Ä—ñ–Ω –æ—Ä–Ω–∞—Ç—É ***
        // –ë“±–ª Canvas-—Ç–∞“ì—ã –ø–∏–∫—Å–µ–ª–¥–µ—Ä —Å–∞–Ω—ã–Ω 2 –µ—Å–µ –∞—Ä—Ç—Ç—ã—Ä–∞–¥—ã (—Å–∞–ø–∞–Ω—ã –∞—Ä—Ç—Ç—ã—Ä–∞–¥—ã)
        canvas.width = displayWidth * scale;
        canvas.height = displayHeight * scale;

        // *** 3. Canvas-—Ç—ã“£ –∫”©—Ä—ñ–Ω–µ—Ç—ñ–Ω (CSS) ”©–ª—à–µ–º–¥–µ—Ä—ñ–Ω –æ—Ä–Ω–∞—Ç—É ***
        // –ë“±–ª Canvas-—Ç—ã“£ –∫”©—Ä—ñ–Ω—ñ—Å –∞–π–º–∞“ì—ã–Ω –±“±—Ä—ã–Ω“ì—ã–¥–∞–π “õ–∞–ª–¥—ã—Ä–∞–¥—ã
        canvas.style.width = displayWidth + 'px';
        canvas.style.height = displayHeight + 'px';
        // –ï—Å–∫–µ—Ä—Ç—É: CSS-—Ç–µ width: 100%; –±–æ–ª“ì–∞–Ω–¥—ã“õ—Ç–∞–Ω, style.width-—Ç—ñ “õ–æ–ª–¥–∞–Ω–±–∞–π–º—ã–∑.
        // –ë—ñ–∑ CSS-—Ç–µ–≥—ñ 100% –µ–Ω–¥—ñ —Å–∞“õ—Ç–∞—É “Ø—à—ñ–Ω, —Ç–µ–∫ –Ω–∞“õ—Ç—ã –ø–∏–∫—Å–µ–ª—å–¥–µ—Ä–¥—ñ “ì–∞–Ω–∞ –º–∞—Å—à—Ç–∞–±—Ç–∞–π–º—ã–∑.

        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        
        // *** 4. –ö–æ–Ω—Ç–µ–∫—Å—Ç—Ç—ñ –º–∞—Å—à—Ç–∞–±—Ç–∞—É ***
        // “ö–æ–ª—Ç–∞“£–±–∞–Ω—ã“£ –¥–∞, –º”ô—Ç—ñ–Ω–Ω—ñ“£ –¥–µ –¥“±—Ä—ã—Å –º–∞—Å—à—Ç–∞–±—Ç–∞–ª—É—ã “Ø—à—ñ–Ω “õ–∞–∂–µ—Ç
        ctx.scale(scale, scale);

        // “ö–∞–ª–∞–º–Ω—ã“£ “õ–∞–ª—ã“£–¥—ã“ì—ã–Ω ”©–∑–≥–µ—Ä—Ç—É (–ú–∞—Å—à—Ç–∞–±—Ç–∞—É–¥–∞–Ω –∫–µ–π—ñ–Ω –¥“±—Ä—ã—Å –∫”©—Ä—ñ–Ω—É—ñ “Ø—à—ñ–Ω)
        // –ï–Ω–¥—ñ 2 –ø–∏–∫—Å–µ–ª—å –µ–∫—ñ –µ—Å–µ–ª–µ–Ω–≥–µ–Ω Canvas-—Ç–∞ –¥–∞ –∞–Ω—ã“õ –±–æ–ª–∞–¥—ã
        ctx.lineWidth = 2; 
        ctx.lineCap = "round"; 
        ctx.lineJoin = "round"; 
        ctx.strokeStyle = "#1E90FF"; // –ö”©–∫ —Ç“Ø—Å

        // –¢“Æ–ó–ï–¢–Ü–õ–ì–ï–ù –ú”ò–¢–Ü–ù –°–ê–õ–£ –õ–û–ì–ò–ö–ê–°–´
        function drawPlaceholderText() {
            if (isCanvasBlank(canvas, scale)) { // isCanvasBlank-—Ç—ã –¥–∞ –º–∞—Å—à—Ç–∞–±—Ç–∞—É –∫–µ—Ä–µ–∫
                ctx.clearRect(0, 0, displayWidth, displayHeight); // –ï–Ω–¥—ñ —Ç–∞–∑–∞–ª–∞—É–¥—ã –¥–∏—Å–ø–ª–µ–π ”©–ª—à–µ–º—ñ–º–µ–Ω –∂–∞—Å–∞–π–º—ã–∑
                
                const label = "“ö–æ–ª “õ–æ–∏—ã—É - –ü–æ–¥–ø–∏—Å–∞—Ç—å";
                
                ctx.font = '12px Arial'; 
                ctx.fillStyle = '#a4b0be'; 
                ctx.textAlign = 'center'; 
                ctx.textBaseline = 'middle'; 

                // –ú”ô—Ç—ñ–Ω–¥—ñ –¥–∏—Å–ø–ª–µ–π ”©–ª—à–µ–º—ñ–Ω–µ —Å”ô–π–∫–µ—Å –æ—Ä—Ç–∞“ì–∞ —Å–∞–ª—É
                ctx.fillText(label, displayWidth / 2, displayHeight / 2);
            }
        }
        
        // –ë–∞—Å—Ç–∞–ø“õ—ã –º”ô—Ç—ñ–Ω–¥—ñ —Å–∞–ª—É
        drawPlaceholderText();


        function getPos(e) {
            const rect = canvas.getBoundingClientRect(); 

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            // –ï–Ω–¥—ñ scaledCanvas-—Ç—ã“£ –ø–æ–∑–∏—Ü–∏—è—Å—ã “õ–∞–∂–µ—Ç –µ–º–µ—Å, —Å–µ–±–µ–±—ñ scale(scale, scale) “õ–æ–ª–¥–∞–Ω—ã–ª–¥—ã
            return {
                x: (clientX - rect.left) / (rect.width / displayWidth),
                y: (clientY - rect.top) / (rect.height / displayHeight)
            };
        }

        const startDraw = (e) => {
            isDrawing = true;
            // –¢–∞–∑–∞–ª–∞—É–¥—ã –¥–∏—Å–ø–ª–µ–π ”©–ª—à–µ–º—ñ–º–µ–Ω –∂–∞—Å–∞–π–º—ã–∑
            ctx.clearRect(0, 0, displayWidth, displayHeight); 

            ctx.beginPath();
            const pos = getPos(e);
            ctx.moveTo(pos.x, pos.y);
            e.preventDefault(); 
        };

        const draw = (e) => {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            e.preventDefault();
        };

        const endDraw = () => { isDrawing = false; };

        // ... (“õ–∞–ª“ì–∞–Ω –æ“õ–∏“ì–∞–ª–∞—Ä–¥—ã —Ç—ñ—Ä–∫–µ—É –ª–æ–≥–∏–∫–∞—Å—ã –±“±—Ä—ã–Ω“ì—ã–¥–∞–π)
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('mouseout', endDraw);
        canvas.addEventListener('touchstart', startDraw);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', endDraw);

        clearBtn.addEventListener('click', () => {
            ctx.clearRect(0, 0, displayWidth, displayHeight);
            drawPlaceholderText(); // –¢–∞–∑–∞–ª–∞“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω placeholder –º”ô—Ç—ñ–Ω—ñ–Ω “õ–∞–π—Ç–∞ —Å–∞–ª–∞–º—ã–∑
        });
        
        canvas.addEventListener('mouseup', handleVoteSelection);
        canvas.addEventListener('touchend', handleVoteSelection);
    }
    
    // *** isCanvasBlank —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω DPI-–¥—ñ –µ—Å–∫–µ—Ä—É “Ø—à—ñ–Ω ”©–∑–≥–µ—Ä—Ç—É ***
    function isCanvasBlank(canvas, scale = 1) {
        const blank = document.createElement('canvas');
        blank.width = canvas.width; // –ù–∞“õ—Ç—ã ”©–ª—à–µ–º–¥—ñ –ø–∞–π–¥–∞–ª–∞–Ω—É
        blank.height = canvas.height;
        return canvas.toDataURL() === blank.toDataURL();
    }
    
     
  // ... (“õ–∞–ª“ì–∞–Ω –∫–æ–¥ ”©–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑)

    /**
     * “ö–æ–ª “õ–æ–π—ã–ª“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω –±–∞—Å“õ–∞ –æ–ø—Ü–∏—è–ª–∞—Ä–¥—ã —Ç–∞–∑–∞—Ä—Ç–∞–¥—ã.
     */
    function handleVoteSelection(e) {
        // *** –¢“Æ–ó–ï–¢–£: –ï“£ –∂–∞“õ—ã–Ω –∫–∞–Ω–¥–∏–¥–∞—Ç –±–ª–æ–≥—ã–Ω —Ç–∞–±–∞–º—ã–∑ (Aijan, Jangyl, —Ç.–±. “Ø—à—ñ–Ω) ***
        // –ë“±–ª div class="vote-section" style="background:#fff; border:1px solid #dcdde1;" –±–ª–æ–≥—ã –±–æ–ª—É—ã –∫–µ—Ä–µ–∫.
        const candidateBlock = e.currentTarget.closest('.vote-section');
        
        if (!candidateBlock) return; // –ï–≥–µ—Ä —Ç–∞–±—ã–ª—Å–∞

        // –ë“±–ª –∫–∞–Ω–¥–∏–¥–∞—Ç—Ç—ã“£ –Ω–µ–º–µ—Å–µ —Å“±—Ä–∞“õ—Ç—ã“£ –±–∞—Ä–ª—ã“õ canvasses-—ñ–Ω —Ç–∞–±–∞–º—ã–∑
        const siblingCanvases = candidateBlock.querySelectorAll('canvas');
        
        const currentCanvas = e.currentTarget;
        
        // –ï–≥–µ—Ä –±“±–ª canvas-—Ç–∞ —Å—É—Ä–µ—Ç —Å–∞–ª—ã–Ω“ì–∞–Ω –±–æ–ª—Å–∞
        if (!isCanvasBlank(currentCanvas)) {
            siblingCanvases.forEach(cvs => {
                if (cvs !== currentCanvas) {
                    // –ë–∞—Å“õ–∞ canvasses-—Ç—ñ —Ç–∞–∑–∞—Ä—Ç–∞–º—ã–∑
                    // setupCanvas –∞—Ä“õ—ã–ª—ã —Ç–∞–∑–∞—Ä—Ç—É –∂”ô–Ω–µ placeholder-–¥—ñ “õ–∞–π—Ç–∞ —Å–∞–ª—É
                    const clearBtn = cvs.parentNode.querySelector('.btn-clear');
                    setupCanvas(cvs, clearBtn); 
                }
            });
        }
    }
// ... (“õ–∞–ª“ì–∞–Ω –∫–æ–¥ ”©–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑)


    /**
     * Canvas-—Ç—ã“£ –±–æ—Å –µ–∫–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ.
     */
    function isCanvasBlank(canvas) {
        const blank = document.createElement('canvas');
        blank.width = canvas.width;
        blank.height = canvas.height;
        return canvas.toDataURL() === blank.toDataURL();
    }
    
    // –ë–∞—Ä–ª—ã“õ canvas-—Ç–∞—Ä–¥—ã –æ—Ä–Ω–∞—Ç—É
    canvases.forEach(canvas => {
        const clearBtn = canvas.parentNode.querySelector('.btn-clear');
        setupCanvas(canvas, clearBtn);
    });

// ----------------------------------------------------------------------------------
// ... (–±–∞—Å“õ–∞ —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä –º–µ–Ω –ª–æ–≥–∏–∫–∞)

// ----------------------------------------------------------------------------------
// --- –ñ—ñ–±–µ—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã ---

    document.getElementById('send-btn').addEventListener('click', async () => {
        // ... (–§–ò–û —Ç–µ–∫—Å–µ—Ä—É –∂”ô–Ω–µ hasSigned —Ç–µ–∫—Å–µ—Ä—É ”©–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑)
        // ...

        const maxRetries = 3; 

        async function attemptSend() {
            statusMsg.style.color = "#3498db";
            statusMsg.innerText = "‚è≥ –ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ...";

            const dataByQuestion = {
                '1': '“Æ–∏ –∫–µ“£–µ—Å—ñ –º“Ø—à–µ–ª–µ—Ä—ñ–Ω —Å–∞–∏–ª–∞—É:',
                '2': '–ë–∞“õ—ã–ª–∞—É—à—ã —Ä–µ–≤–∏–∑–æ—Ä —Å–∞–∏–ª–∞—É:',
                '3': '–ú–Ü–ë —Ç”©—Ä–∞“ì–∞—Å—ã–Ω —Å–∞–∏–ª–∞—É:'
            };
            
            const signedVotes = [];
            
            // --- 1. –¢–µ–∫ “õ–æ–ª “õ–æ–π—ã–ª“ì–∞–Ω –¥–∞—É—ã—Å—Ç–∞—Ä–¥—ã –∂–∏–Ω–∞—É ---
            canvases.forEach(cvs => {
                const label = cvs.getAttribute('data-label'); 
                const questionNumber = label.charAt(0);

                if (!isCanvasBlank(cvs)) {
                    // *** üí• –¢“Æ–ó–ï–¢–£: PNG-–¥–µ–Ω JPEG-–≥–µ –∞—É—ã—Å—Ç—ã—Ä—É –∂”ô–Ω–µ —Å–∞–ø–∞–Ω—ã —Ç”©–º–µ–Ω–¥–µ—Ç—É (50Kb –ª–∏–º–∏—Ç—ñ–Ω —à–µ—à—É) ***
                    const dataURL = cvs.toDataURL('image/webp', 0.7); // 70% —Å–∞–ø–∞
                    
                    signedVotes.push({
                        qNum: questionNumber,
                        label: label,
                        dataURL: dataURL
                    });
                }
            });
            
            // ... (“ö–∞–ª“ì–∞–Ω emailBody –∂”ô–Ω–µ –∂—ñ–±–µ—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã ”©–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑)
            // ...
            
            let emailBody = `<h3>“ö–∞—Ç—ã—Å—É—à—ã: ${fullName}</h3><hr>`;

            // ... (Email Body “õ“±—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã)
            
            const templateParams = {
                my_data: emailBody,
                full_name: fullName
            };

            // ... (–ñ—ñ–±–µ—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã)
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    await emailjs.send('service_0mczhxj', 'template_t4xdvyl', templateParams);
                    statusMsg.style.color = "#27ae60";
                    statusMsg.innerText = "‚úÖ –°”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ! –†–∞—Ö–º–µ—Ç.";
                    return true; 
                } catch (err) {
                    console.error("–ñ—ñ–±–µ—Ä—É “õ–∞—Ç–µ—Å—ñ:", err);
                    statusMsg.style.color = "#f39c12";
                    statusMsg.innerText = `‚ö†Ô∏è –ñ—ñ–±–µ—Ä—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ. “ö–∞–π—Ç–∞–ª–∞—É–¥–∞... (${attempt + 1}/${maxRetries})`;
                    await new Promise(resolve => setTimeout(resolve, 1000 * (attempt + 1))); 
                }
            }
            
            statusMsg.style.color = "#e74c3c";
            statusMsg.innerText = "‚ùå –ñ—ñ–±–µ—Ä—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –ö–µ–π—ñ–Ω—ñ—Ä–µ–∫ “õ–∞–π—Ç–∞–ª–∞–ø –∫”©—Ä—ñ“£—ñ–∑.";
            return false;
        }

        await attemptSend();
    });
</script>
</body>
</html>
