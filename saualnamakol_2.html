<!DOCTYPE html>
<html lang="kz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢“Ø–∑–µ—Ç—ñ–ª–≥–µ–Ω –î–∞—É—ã—Å –ë–µ—Ä—É –ü–∞—Ä–∞“ì—ã - “ö–æ–ª—Ç–∞“£–±–∞</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        /* –ñ–∞–ª–ø—ã —Å—Ç–∏–ª—å–¥–µ—Ä */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #eef1f5; 
            padding: 20px; 
            margin: 0;
            display: flex;
            justify-content: center;
        }
        .container { 
            background: white; 
            width: 100%;
            max-width: 900px; /* –ö”©–±—ñ—Ä–µ–∫ —Å“±—Ä–∞“õ—Ç–∞—Ä“ì–∞ –æ—Ä—ã–Ω –±–µ—Ä—É “Ø—à—ñ–Ω –µ–Ω—ñ–Ω “±–ª“ì–∞–π—Ç—Ç—ã“õ */
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* –¢–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä */
        h1 {
            font-size: 18px;
            color: #2c3e50;
            font-weight: bold;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.4;
        }
        h2 {
            font-size: 14px;
            color: #34495e;
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* –ö—ñ—Ä—ñ—Å ”©—Ä—ñ—Å—ñ */
        #full-name { 
            width: calc(100% - 20px); 
            padding: 15px 10px; 
            margin-bottom: 25px;
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
        }

        /* –°“±—Ä–∞“õ –±–ª–æ–≥—ã–Ω—ã“£ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (–∂–∞–ª–ø—ã —Å“±—Ä–∞“õ) */
        .vote-section {
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }

        /* –ù“±—Å“õ–∞–ª–∞—Ä–¥—ã “±—Å—Ç–∞–π—Ç—ã–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (“õ–æ–ª–¥–∞—É, “õ–∞—Ä—Å—ã, “õ–∞–ª—ã—Å) */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* –´“£“ì–∞–π–ª—ã, –±–µ–π—ñ–º–¥–µ–ª–µ—Ç—ñ–Ω —Ç–æ—Ä */
            gap: 15px;
            margin-top: 15px;
        }

        /* ”ò—Ä–±—ñ—Ä –Ω“±—Å“õ–∞ –±–ª–æ–≥—ã (–º—ã—Å–∞–ª—ã, "“õ–æ–ª–¥–∞–∏–º—ã–Ω") */
        .option-block {
            background: #ffffff;
            border: 1px solid #dcdde1;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .option-text {
            font-size: 14px;
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        /* Canvas - “õ–æ–ª “õ–æ—é –∞–ª–∞“£—ã */
        canvas {
            border: 1px dashed #a4b0be;
            background-color: #fff;
            cursor: crosshair;
            width: 100%; /* –ë–µ–π—ñ–º–¥–µ–ª—É “Ø—à—ñ–Ω –µ–Ω—ñ 100% */
            height: 104px; /* –¢“±—Ä–∞“õ—Ç—ã –±–∏—ñ–∫—Ç—ñ–∫ */
            display: block;
            touch-action: none; /* –°–µ–Ω—Å–æ—Ä–ª—ã —ç–∫—Ä–∞–Ω–¥–∞ —Å—ã—Ä“ì—ã—Ç—É–¥—ã ”©—à—ñ—Ä–µ–¥—ñ */
            border-radius: 4px;
        }
        
        /* –¢–∞–∑–∞–ª–∞—É –±–∞—Ç—ã—Ä–º–∞—Å—ã */
        .btn-clear { 
            width: 100%; 
            padding: 8px; 
            background: #e74c3c; 
            color: white; 
            border: none; 
            cursor: pointer; 
            margin-top: 10px;
            border-radius: 4px;
            font-size: 14px;
            transition: background 0.3s;
        }
        .btn-clear:hover { background: #c0392b; }

        /* –ñ—ñ–±–µ—Ä—É –±–∞—Ç—ã—Ä–º–∞—Å—ã */
        .submit-btn { 
            width: 100%; 
            padding: 18px; 
            background: #27ae60; 
            color: white; 
            border: none; 
            cursor: pointer; 
            margin-top: 30px; 
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            transition: background 0.3s;
        }
        .submit-btn:hover { background: #2ecc71; }
        
        /* –•–∞–±–∞—Ä–ª–∞–º–∞ –º”ô—Ä—Ç–µ–±–µ—Å—ñ */
        #status {
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
        }

        /* –ú–æ–±–∏–ª—å–¥—ñ “õ“±—Ä—ã–ª“ì—ã–ª–∞—Ä“ì–∞ –±–µ–π—ñ–º–¥–µ–ª—É (–µ–≥–µ—Ä —Ç–æ—Ä –±—ñ—Ä “õ–∞—Ç–∞—Ä–¥–∞ —Ç“±—Ä–º–∞—Å–∞) */
        @media (max-width: 650px) {
            .options-grid {
                grid-template-columns: 1fr; /* 650px —Ç”©–º–µ–Ω –±–æ–ª—Å–∞, –Ω“±—Å“õ–∞–ª–∞—Ä –±—ñ—Ä-–±—ñ—Ä—ñ–Ω—ñ“£ –∞—Å—Ç—ã–Ω–¥–∞ –æ—Ä–Ω–∞–ª–∞—Å–∞–¥—ã */
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìã ‚Ññ<br>–ü”ô—Ç–µ—Ä–ª–µ—Ä–¥—ñ“£, —Ç“±—Ä“ì—ã–Ω –µ–º–µ—Å “Ø–π-–∂”ô–π –º–µ–Ω—à—ñ–∫ —ñ–∏–µ–ª–µ—Ä—ñ–Ω—ñ“£ –°—ã—Ä—Ç—Ç–∞–π –¥–∞—É—ã—Å –±–µ—Ä—É –ø–∞—Ä–∞“ì—ã<br>
        –õ–∏—Å—Ç –≤ –∑–∞–æ—á–Ω–æ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –∫–≤–∞—Ä—Ç–∏—Ä, –Ω–µ–∂–∏–ª—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π</h1>
    
    <input type="text" id="full-name" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑ (–§.–ò.–û.)" required>

    <div class="vote-section" data-question-id="q1">
        <h2>1. “Æ–∏ –∫–µ“£–µ—Å—ñ –º“Ø—à–µ–ª–µ—Ä—ñ–Ω —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å —á–ª–µ–Ω–æ–≤ –°–æ–≤–µ—Ç–∞ –¥–æ–º–∞:</h2>
        
        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:16px;">–ö–∞–Ω–¥–∏–¥–∞—Ç: **Aijan**</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_aijan_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="400" height="150" data-label="1.1. Aijan - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_aijan_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="400" height="150" data-label="1.2. Aijan - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_aijan_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="400" height="150" data-label="1.3. Aijan - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
        
        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1; margin-top:15px;">
            <div class="option-text" style="font-size:16px;">–ö–∞–Ω–¥–∏–¥–∞—Ç: **Jangyl**</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_jangyl_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="400" height="150" data-label="1.4. Jangyl - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_jangyl_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="400" height="150" data-label="1.5. Jangyl - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_jangyl_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="400" height="150" data-label="1.6. Jangyl - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>

        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1; margin-top:15px;">
            <div class="option-text" style="font-size:16px;">–ö–∞–Ω–¥–∏–¥–∞—Ç: **Gylnar**</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_gylnar_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="400" height="150" data-label="1.7. Gylnar - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_gylnar_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="400" height="150" data-label="1.8. Gylnar - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_gylnar_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="400" height="150" data-label="1.9. Gylnar - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>

        <div class="vote-section" style="background:#fff; border:1px solid #dcdde1; margin-top:15px;">
            <div class="option-text" style="font-size:16px;">–ö–∞–Ω–¥–∏–¥–∞—Ç: **Alia**</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_alia_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="400" height="150" data-label="1.10. Alia - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_alia_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="400" height="150" data-label="1.11. Alia - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_alia_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="400" height="150" data-label="1.12. Alia - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
        
    </div>
    
    <div class="vote-section" data-question-id="q2">
        <h2>2. –ë–∞“õ—ã–ª–∞—É—à—ã —Ä–µ–±–∏–∑–æ—Ä —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ä–µ–≤–∏–∑–æ—Ä–∞:</h2>
            <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:16px;">–ö–∞–Ω–¥–∏–¥–∞—Ç: **Marat**</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q2_marat_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="400" height="150" data-label="2.1. Marat - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q2_marat_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="400" height="150" data-label="2.2. Marat - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q2_marat_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="400" height="150" data-label="2.3. Marat - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
    </div>

    <div class="vote-section" data-question-id="q3"> 
        <h2>3. –ú–Ü–ë —Ç”©—Ä–∞“ì–∞—Å—ã–Ω —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—è –û–°–ò:</h2>
            <div class="vote-section" style="background:#fff; border:1px solid #dcdde1;">
            <div class="option-text" style="font-size:16px;">–ö–∞–Ω–¥–∏–¥–∞—Ç: **–°–µ—Ä—ñ–∫–∂–∞–Ω –¢”©–ª–µ—É“ì–∞–ª–∏“±–ª—ã –ö”©–∫–µ–±–∞–π**</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q3_serikjan_za"> 
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas width="400" height="150" data-label="3.1. Serikjan - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q3_serikjan_protiv"> 
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas width="400" height="150" data-label="3.2. Serikjan - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q3_serikjan_vozderzhu"> 
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas width="400" height="150" data-label="3.3. Serikjan - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas> 
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
    </div>


    <button class="submit-btn" id="send-btn">–ñ—ñ–±–µ—Ä—É</button>
    <p id="status"></p>
</div>

<script>
    // EMAILJS –ë–ê–ü–¢–ê–£–´ (–°—ñ–∑–¥—ñ“£ ID-—ñ“£—ñ–∑–¥—ñ –ø–∞–π–¥–∞–ª–∞–Ω–∞–º—ã–∑)
    emailjs.init("HySfhPitSDqpVM31p"); 

    const statusMsg = document.getElementById('status');

    // Canvas —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä—ñ–Ω —Ç–∞–±—É
    const canvases = document.querySelectorAll('canvas');

    // Canvas —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—ã–Ω –æ—Ä–Ω–∞—Ç—É
    canvases.forEach(canvas => {
        const clearBtn = canvas.parentNode.querySelector('.btn-clear');
        setupCanvas(canvas, clearBtn);
    });

    /**
     * Canvas-“õ–∞ “õ–æ–ª “õ–æ—é —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –æ—Ä–Ω–∞—Ç–∞–¥—ã.
     * @param {HTMLCanvasElement} canvas “ö–æ–ª “õ–æ—é –∞–ª–∞“£—ã
     * @param {HTMLButtonElement} clearBtn –¢–∞–∑–∞–ª–∞—É –±–∞—Ç—ã—Ä–º–∞—Å—ã
     */
    function setupCanvas(canvas, clearBtn) {
        // HTML canvas —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä—ñ–Ω–µ —Å”ô–π–∫–µ—Å –∫–µ–ª—É “Ø—à—ñ–Ω canvas.width –∂”ô–Ω–µ canvas.height 
        // –∞—Ç—Ä–∏–±—É—Ç—Ç–∞—Ä—ã–Ω HTML —ñ—à—ñ–Ω–¥–µ –Ω–µ–º–µ—Å–µ –æ—Å—ã –∂–µ—Ä–¥–µ –æ—Ä–Ω–∞—Ç—É –∫–µ—Ä–µ–∫.
        // –°—Ç–∏–ª—å–¥–µ–≥—ñ width: 100% –±–æ–ª“ì–∞–Ω–¥—ã“õ—Ç–∞–Ω, —Å—ã–∑—ã“õ—Ç–∞—Ä –¥“±—Ä—ã—Å —à—ã“ì—É—ã “Ø—à—ñ–Ω
        // canvas.width/height –Ω–∞“õ—Ç—ã –ø–∏–∫—Å–µ–ª—å–¥–µ—Ä—ñ–Ω –æ—Ä–Ω–∞—Ç—É –º–∞“£—ã–∑–¥—ã.
        // 400x150 –ø–∏–∫—Å–µ–ª—å —Ä–µ—Ç—ñ–Ω–¥–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—Ç–∞–π–º—ã–∑.
        canvas.width = 400;
        canvas.height = 150;

        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        // “ö–∞–ª–∞–º —Å—Ç–∏–ª—å–¥–µ—Ä—ñ
        ctx.lineWidth = 3; 
        ctx.lineCap = "round"; 
        ctx.lineJoin = "round"; 
        ctx.strokeStyle = "#1E90FF"; 

        /**
         * –≠–∫—Ä–∞–Ω–¥–∞“ì—ã —Ç—ã—à“õ–∞–Ω/—Å–∞—É—Å–∞“õ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–ª–∞—Ä—ã–Ω Canvas-—Ç—ã“£ —ñ—à–∫—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–ª–∞—Ä—ã–Ω–∞ —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä–µ–¥—ñ.
         */
        function getPos(e) {
            const rect = canvas.getBoundingClientRect(); // Canvas-—Ç—ã“£ —ç–∫—Ä–∞–Ω–¥–∞“ì—ã –Ω–∞“õ—Ç—ã ”©–ª—à–µ–º—ñ
            
            // –ú–∞—Å—à—Ç–∞–± –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ñ–Ω –µ—Å–µ–ø—Ç–µ—É
            const scaleX = canvas.width / rect.width; 
            const scaleY = canvas.height / rect.height;

            // –°–µ–Ω—Å–æ—Ä–ª—ã –Ω–µ–º–µ—Å–µ —Ç—ã—à“õ–∞–Ω –æ“õ–∏“ì–∞—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        const startDraw = (e) => {
            isDrawing = true;
            ctx.beginPath();
            const pos = getPos(e);
            ctx.moveTo(pos.x, pos.y);
            e.preventDefault(); // –≠–∫—Ä–∞–Ω –∂—ã–ª–∂—ã–º–∞—É—ã “Ø—à—ñ–Ω
        };

        const draw = (e) => {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            e.preventDefault();
        };

        const endDraw = () => { isDrawing = false; };

        // –¢—ã—à“õ–∞–Ω –æ“õ–∏“ì–∞–ª–∞—Ä—ã
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('mouseout', endDraw);

        // –°–µ–Ω—Å–æ—Ä–ª—ã“õ (Touch) –æ“õ–∏“ì–∞–ª–∞—Ä—ã
        canvas.addEventListener('touchstart', startDraw);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', endDraw);

        // –¢–∞–∑–∞–ª–∞—É –±–∞—Ç—ã—Ä–º–∞—Å—ã
        clearBtn.addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    }

    /**
     * Canvas-—Ç—ã“£ –±–æ—Å –µ–∫–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ.
     * @param {HTMLCanvasElement} canvas –¢–µ–∫—Å–µ—Ä—ñ–ª–µ—Ç—ñ–Ω Canvas
     * @returns {boolean} –ë–æ—Å –±–æ–ª—Å–∞ true, ”ô–π—Ç–ø–µ—Å–µ false
     */
    function isCanvasBlank(canvas) {
        const blank = document.createElement('canvas');
        blank.width = canvas.width;
        blank.height = canvas.height;
        return canvas.toDataURL() === blank.toDataURL();
    }


// ... (–±–∞—Å“õ–∞ –∫–æ–¥ –±“±—Ä—ã–Ω“ì—ã–¥–∞–π “õ–∞–ª–∞–¥—ã)

// –ñ—ñ–±–µ—Ä—É –±–∞—Ç—ã—Ä–º–∞—Å—ã
document.getElementById('send-btn').addEventListener('click', async () => {
    // ... (–ê—Ç—ã-–∂”©–Ω–¥—ñ —Ç–µ–∫—Å–µ—Ä—É –∫–æ–¥—ã)

    async function attemptSend() {
        statusMsg.style.color = "#3498db";
        statusMsg.innerText = "‚è≥ –ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ...";

        const dataByQuestion = {
            '1': '“Æ–∏ –∫–µ“£–µ—Å—ñ –º“Ø—à–µ–ª–µ—Ä—ñ–Ω —Å–∞–∏–ª–∞—É:',
            '2': '–ë–∞“õ—ã–ª–∞—É—à—ã —Ä–µ–≤–∏–∑–æ—Ä —Å–∞–∏–ª–∞—É:',
            '3': '–ú–Ü–ë —Ç”©—Ä–∞“ì–∞—Å—ã–Ω —Å–∞–∏–ª–∞—É:'
        };
        
        // –î–∞—É—ã—Å –±–µ—Ä—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ–Ω —Å“±—Ä–∞“õ –Ω”©–º—ñ—Ä—ñ –±–æ–π—ã–Ω—à–∞ —Ç–æ–ø—Ç–∞—Å—Ç—ã—Ä—É“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω –æ–±—ä–µ–∫—Ç
        const results = {
            '1': [],
            '2': [],
            '3': []
        };
        
        // --- –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂–∏–Ω–∞—É –∂”ô–Ω–µ —Ç–æ–ø—Ç–∞—Å—Ç—ã—Ä—É ---
        canvases.forEach(cvs => {
            const label = cvs.getAttribute('data-label'); 
            const questionNumber = label.charAt(0); // –°“±—Ä–∞“õ –Ω”©–º—ñ—Ä—ñ–Ω –∞–ª—É (1, 2 –Ω–µ–º–µ—Å–µ 3)
            let resultHTML = '';
            
            if(isCanvasBlank(cvs)) {
                // “ö–æ–ª “õ–æ–π—ã–ª–º–∞“ì–∞–Ω –∂–∞“ì–¥–∞–π
                resultHTML = `<p style="margin: 5px 0 5px 20px;">
                                <strong>${label}</strong>: ‚ùå “ö–æ–ª “õ–æ–π—ã–ª–º–∞–¥—ã
                              </p>`;
            } else {
                // “ö–æ–ª “õ–æ–π—ã–ª“ì–∞–Ω –∂–∞“ì–¥–∞–π (–°—É—Ä–µ—Ç—Ç—ñ Base64 –∞—Ä“õ—ã–ª—ã –∂—ñ–±–µ—Ä–µ–º—ñ–∑)
                resultHTML = `<div style="margin: 5px 0 5px 20px; border: 1px solid #eee; padding: 10px; border-radius: 4px;">
                                <p style="font-weight: bold; margin-bottom: 5px;">${label}:</p>
                                <img src="${cvs.toDataURL('image/png')}" 
                                     style="max-width:300px; height: auto; border:1px solid #ccc; background-color: #f0f0f0; border-radius: 4px; display: block;"/>
                             </div>`;
            }
            
            if (results[questionNumber]) {
                results[questionNumber].push(resultHTML);
            }
        });

        // --- –≠–ª–µ–∫—Ç—Ä–æ–Ω–¥—ã“õ –ø–æ—à—Ç–∞–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ –º”ô—Ç—ñ–Ω—ñ–Ω “õ“±—Ä—É ---
        let emailBody = `<h3>“ö–∞—Ç—ã—Å—É—à—ã: ${fullName}</h3><hr>`;

        for (const qNum in dataByQuestion) {
            // –ï“£ –∞–ª–¥—ã–º–µ–Ω —Å“±—Ä–∞“õ —Ç–∞“õ—ã—Ä—ã–±—ã–Ω “õ–æ—Å–∞–º—ã–∑
            emailBody += `<h2 style="color: #2c3e50; border-left: 5px solid #3498db; padding-left: 10px;">
                            ${qNum}. ${dataByQuestion[qNum]}
                          </h2>`;
            
            // –°–æ–¥–∞–Ω –∫–µ–π—ñ–Ω –æ—Å—ã —Å“±—Ä–∞“õ“õ–∞ “õ–∞—Ç—ã—Å—Ç—ã –±–∞—Ä–ª—ã“õ –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä–¥—ñ “õ–æ—Å–∞–º—ã–∑
            if (results[qNum].length > 0) {
                emailBody += results[qNum].join('');
            } else {
                emailBody += `<p style="margin: 5px 0 5px 20px; color: #e74c3c;">–û—Å—ã —Å“±—Ä–∞“õ –±–æ–π—ã–Ω—à–∞ –¥–∞—É—ã—Å —Ç—ñ—Ä–∫–µ–ª–º–µ–¥—ñ.</p>`;
            }
            emailBody += '<hr>';
        }


        const templateParams = {
            my_data: emailBody, // Email Body (HTML —Ñ–æ—Ä–º–∞—Ç—ã–Ω–¥–∞)
            full_name: fullName // –¢–∞“õ—ã—Ä—ã–ø“õ–∞ “õ–æ—Å—É “Ø—à—ñ–Ω
        };

        // ... (“õ–∞–π—Ç–∞ –∂—ñ–±–µ—Ä—É (retry) –ª–æ–≥–∏–∫–∞—Å—ã –∂”ô–Ω–µ try/catch –±–ª–æ–∫—Ç–∞—Ä—ã –±“±—Ä—ã–Ω“ì—ã–¥–∞–π “õ–∞–ª–∞–¥—ã)
        
        for (let attempt = 0; attempt < maxRetries; attempt++) {
            try {
                // EmailJS –∂—ñ–±–µ—Ä—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
                await emailjs.send('service_0mczhxj', 'template_t4xdvyl', templateParams);
                statusMsg.style.color = "#27ae60";
                statusMsg.innerText = "‚úÖ –°”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ! –†–∞—Ö–º–µ—Ç.";
                return true; 
            } catch (err) {
                // ... (“ö–∞—Ç–µ ”©“£–¥–µ—É –ª–æ–≥–∏–∫–∞—Å—ã –±“±—Ä—ã–Ω“ì—ã–¥–∞–π “õ–∞–ª–∞–¥—ã)
            }
        }
        return false;
    }

    await attemptSend();
});
</script>
</body>
</html>