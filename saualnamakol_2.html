<!DOCTYPE html>
<html lang="kz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—É—ã—Å –±–µ—Ä—ñ—É –ø–∞—Ä–∞“ì—ã</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        /* –ñ–∞–ª–ø—ã —Å—Ç–∏–ª—å–¥–µ—Ä */
        body { font-family: 'Inter', sans-serif; background-color: #eef1f5; margin: 0; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 900px; padding: 8px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        /* –¢–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä */
        h1 { font-size: 18px; color: #2c3e50; font-weight: normal; text-align: center; line-height: 1.1; }
        h2 { font-size: 14px; color: #34495e; font-weight: normal; margin: 4px; }
        /* –ö—ñ—Ä—ñ—Å ”©—Ä—ñ—Å—ñ */
        #full-name { width: calc(100% - 20px); padding: 8px 8px; margin-bottom: 8px; border: 1px solid #bdc3c7; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        /* –°“±—Ä–∞“õ –±–ª–æ–≥—ã–Ω—ã“£ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (–∂–∞–ª–ø—ã —Å“±—Ä–∞“õ) */
        .vote-section { border: 1px solid #dfe6e9; border-radius: 8px; padding: 8px; margin-bottom: 8px; background-color: #f8f9fa; }
        /* –ù“±—Å“õ–∞–ª–∞—Ä–¥—ã “±—Å—Ç–∞–π—Ç—ã–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (“õ–æ–ª–¥–∞—É, “õ–∞—Ä—Å—ã, “õ–∞–ª—ã—Å) */
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* 120px-–∫–µ ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ */ gap: 8px; }
        /* ”ò—Ä–±—ñ—Ä –Ω“±—Å“õ–∞ –±–ª–æ–≥—ã (–º—ã—Å–∞–ª—ã, "“õ–æ–ª–¥–∞–∏–º—ã–Ω") */
        .option-block { background: #ffffff; border-radius: 8px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
        .option-text { font-size: 11px; /* –ö—ñ—à—ñ—Ä–µ–π—Ç—ñ–ª–¥—ñ */ color: #5e6062; font-weight: normal; margin-bottom: 2px; text-align: center; }
        /* Canvas - “õ–æ–ª “õ–æ—é –∞–ª–∞“£—ã */
        canvas {
            border: 1px dashed #a4b0be;
            background-color: #fff;
            cursor: crosshair;
            width: 120px; /* –û–¥–∞–Ω ”ô—Ä—ñ –∫—ñ—à—ñ—Ä–µ–π—Ç—ñ–ª–¥—ñ */
            height: 40px; /* –û–¥–∞–Ω ”ô—Ä—ñ –∫—ñ—à—ñ—Ä–µ–π—Ç—ñ–ª–¥—ñ */
            display: block;
            touch-action: none;
            border-radius: 4px;
        }
        /* –¢–∞–∑–∞–ª–∞—É –±–∞—Ç—ã—Ä–º–∞—Å—ã */
        .btn-clear { width: 100%; padding: 4px 8px; background: #848180; color: white; border: none; cursor: pointer; margin-top: 4px; border-radius: 4px; font-size: 10px; transition: background 0.3s; }
        .btn-clear:hover { background: #e7c50d; }
        /* –ñ—ñ–±–µ—Ä—É –±–∞—Ç—ã—Ä–º–∞—Å—ã */
        .submit-btn { width: 100%; padding: 10px; background: #878678; color: white; border: none; cursor: pointer; margin-top: 2px; border-radius: 8px; font-size: 14px; font-weight: normal; transition: background 0.3s; }
        .submit-btn:hover { background: #e7c50d; }
        /* –•–∞–±–∞—Ä–ª–∞–º–∞ –º”ô—Ä—Ç–µ–±–µ—Å—ñ */
        #status { text-align: center; margin-top: 15px; font-weight: 600; }
        /* –ú–æ–±–∏–ª—å–¥—ñ “õ“±—Ä—ã–ª“ì—ã–ª–∞—Ä“ì–∞ –±–µ–π—ñ–º–¥–µ–ª—É */
        @media (max-width: 650px) {
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìã ‚Ññ<br>–ü”ô—Ç–µ—Ä–ª–µ—Ä–¥—ñ“£, —Ç“±—Ä“ì—ã–Ω –µ–º–µ—Å “Ø–π-–∂”ô–π –º–µ–Ω—à—ñ–∫ —ñ–∏–µ–ª–µ—Ä—ñ–Ω—ñ“£ –°—ã—Ä—Ç—Ç–∞–π –¥–∞—É—ã—Å –±–µ—Ä—É –ø–∞—Ä–∞“ì—ã<br>
        –õ–∏—Å—Ç –≤ –∑–∞–æ—á–Ω–æ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –∫–≤–∞—Ä—Ç–∏—Ä, –Ω–µ–∂–∏–ª—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π</h1>
    
    <input type="text" id="full-name" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑, –ø”ô—Ç–µ—Ä, —Ç–µ–ª–µ–ø–æ–Ω‚Ññ, email - –§–∏–æ, ‚Ññ –∫–≤–∞—Ä—Ç–∏—Ä—ã, —Ç–µ–ª–æ—Ñ–æ–Ω, email" required="">

    <div class="vote-section" data-question-id="q1">
        <h2>1. “Æ–∏ –∫–µ“£–µ—Å—ñ –º“Ø—à–µ–ª–µ—Ä—ñ–Ω —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å —á–ª–µ–Ω–æ–≤ –°–æ–≤–µ—Ç–∞ –¥–æ–º–∞:</h2>
        
        <div class="candidate-block" style="background:#fff; border:1px solid #dcdde1; margin-bottom: 8px; padding: 4px;">
            <div class="option-text" style="font-size:14px;">Aijan</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_aijan_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas data-label="1.1. Aijan - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_aijan_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas data-label="1.2. Aijan - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_aijan_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas data-label="1.3. Aijan - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
        
        <div class="candidate-block" style="background:#fff; border:1px solid #dcdde1; margin-bottom: 8px; padding: 4px;">
            <div class="option-text" style="font-size:14px;">Jangyl</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_jangyl_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas data-label="1.4. Jangyl - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_jangyl_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas data-label="1.5. Jangyl - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_jangyl_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas data-label="1.6. Jangyl - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>

        <div class="candidate-block" style="background:#fff; border:1px solid #dcdde1; margin-bottom: 8px; padding: 4px;">
            <div class="option-text" style="font-size:14px;">Gylnar</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_gylnar_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas data-label="1.7. Gylnar - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_gylnar_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas data-label="1.8. Gylnar - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_gylnar_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas data-label="1.9. Gylnar - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>

        <div class="candidate-block" style="background:#fff; border:1px solid #dcdde1; margin-bottom: 8px; padding: 4px;">
            <div class="option-text" style="font-size:14px;">Alia</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q1_alia_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas data-label="1.10. Alia - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q1_alia_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas data-label="1.11. Alia - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q1_alia_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas data-label="1.12. Alia - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
        
    </div>
    
    <div class="vote-section" data-question-id="q2">
        <h2>2. –ë–∞“õ—ã–ª–∞—É—à—ã —Ä–µ–±–∏–∑–æ—Ä —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ä–µ–≤–∏–∑–æ—Ä–∞:</h2>
            <div class="candidate-block" style="background:#fff; border:1px solid #dcdde1; margin-bottom: 8px; padding: 4px;">
            <div class="option-text" style="font-size:14px;">Marat</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q2_marat_za">
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas data-label="2.1. Marat - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q2_marat_protiv">
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas data-label="2.2. Marat - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q2_marat_vozderzhu">
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas data-label="2.3. Marat - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
    </div>

    <div class="vote-section" data-question-id="q3"> 
        <h2>3. –ú–Ü–ë —Ç”©—Ä–∞“ì–∞—Å—ã–Ω —Å–∞–∏–ª–∞—É - –í—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—è –û–°–ò:</h2>
            <div class="candidate-block" style="background:#fff; border:1px solid #dcdde1; margin-bottom: 8px; padding: 4px;">
            <div class="option-text" style="font-size:14px;">–°–µ—Ä—ñ–∫–∂–∞–Ω –¢”©–ª–µ—É“ì–∞–ª–∏“±–ª—ã –ö”©–∫–µ–±–∞–π</div>
            <div class="options-grid">
                
                <div class="option-block" data-option-id="q3_serikjan_za"> 
                    <div class="option-text">“õ–æ–ª–¥–∞–∏–º—ã–Ω - –∑–∞</div>
                    <canvas data-label="3.1. Serikjan - “õ–æ–ª–¥–∞–∏–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>

                <div class="option-block" data-option-id="q3_serikjan_protiv"> 
                    <div class="option-text">“õ–∞—Ä—Å—ã–º—ã–Ω - –ø—Ä–æ—Ç–∏–≤</div>
                    <canvas data-label="3.2. Serikjan - “õ–∞—Ä—Å—ã–º—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
                
                <div class="option-block" data-option-id="q3_serikjan_vozderzhu"> 
                    <div class="option-text">“õ–∞–ª—ã—Å–ø—ã–Ω - –≤–æ–∑–¥–µ—Ä–∂—É—Å—å</div>
                    <canvas data-label="3.3. Serikjan - “õ–∞–ª—ã—Å–ø—ã–Ω"></canvas>
                    <button class="btn-clear">–¢–∞–∑–∞–ª–∞—É</button>
                </div>
            </div>
        </div>
    </div>


    <button class="submit-btn" id="send-btn">–ñ—ñ–±–µ—Ä—É</button>
    <p id="status"></p>
</div>

<script>
    // EMAILJS –ë–ê–ü–¢–ê–£–´ (ID-—ñ“£—ñ–∑–¥—ñ –ø–∞–π–¥–∞–ª–∞–Ω—ã“£—ã–∑)
    emailjs.init("HySfhPitSDqpVM31p"); 

    const statusMsg = document.getElementById('status');
    const canvases = document.querySelectorAll('canvas');

    // –û–î–ê–ù ”ò–†–Ü –ö–Ü–®–Ü–†–ï–ô–¢–Ü–õ–ì–ï–ù ”®–õ–®–ï–ú–î–ï–†
    const DISPLAY_WIDTH = 120; 
    const DISPLAY_HEIGHT = 40; 

    /**
     * Canvas-—Ç—ã“£ –±–æ—Å –µ–∫–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ.
     */
    function isCanvasBlank(canvas) {
        const blank = document.createElement('canvas');
        blank.width = canvas.width;
        blank.height = canvas.height;
        return canvas.toDataURL() === blank.toDataURL();
    }
    
    /**
     * Canvas-“õ–∞ “õ–æ–ª “õ–æ—é —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –æ—Ä–Ω–∞—Ç–∞–¥—ã. (–ñ–æ“ì–∞—Ä—ã DPI “õ–æ–ª–¥–∞—É—ã–º–µ–Ω)
     */
    function setupCanvas(canvas, clearBtn) {
        const scale = window.devicePixelRatio || 1; 
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        
        // 1. –ù–∞“õ—Ç—ã —ñ—à–∫—ñ (buffer) ”©–ª—à–µ–º–¥–µ—Ä—ñ–Ω –æ—Ä–Ω–∞—Ç—É (DPI “Ø—à—ñ–Ω)
        canvas.width = DISPLAY_WIDTH * scale;
        canvas.height = DISPLAY_HEIGHT * scale;

        // 2. –ö”©—Ä—ñ–Ω–µ—Ç—ñ–Ω (CSS) ”©–ª—à–µ–º–¥–µ—Ä—ñ–Ω –æ—Ä–Ω–∞—Ç—É
        canvas.style.width = DISPLAY_WIDTH + 'px';
        canvas.style.height = DISPLAY_HEIGHT + 'px';

        // 3. –ö–æ–Ω—Ç–µ–∫—Å—Ç—Ç—ñ –º–∞—Å—à—Ç–∞–±—Ç–∞—É (–°—ã–∑—É–¥—ã DPI-–º–µ–Ω —Å”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É)
        ctx.scale(scale, scale);

        ctx.lineWidth = 1.5; /* –°—ã–∑—ã“õ—Ç—ã“£ “õ–∞–ª—ã“£–¥—ã“ì—ã –∫—ñ—à—ñ—Ä–µ–π—Ç—ñ–ª–¥—ñ */
        ctx.lineCap = "round"; 
        ctx.lineJoin = "round"; 
        ctx.strokeStyle = "#1E90FF"; 

        // –ú”ò–¢–Ü–ù –°–ê–õ–£
        function drawPlaceholderText() {
            if (isCanvasBlank(canvas)) { 
                ctx.clearRect(0, 0, DISPLAY_WIDTH, DISPLAY_HEIGHT); 
                
                const label = "“ö–æ–ª “õ–æ–∏—ã—É - –ü–æ–¥–ø–∏—Å–∞—Ç—å";
                
                ctx.font = '9px Arial'; /* “ö–∞—Ä—ñ–ø ”©–ª—à–µ–º—ñ –∫—ñ—à—ñ—Ä–µ–π—Ç—ñ–ª–¥—ñ */
                ctx.fillStyle = '#a4b0be'; 
                ctx.textAlign = 'center'; 
                ctx.textBaseline = 'middle'; 

                // –ú”ô—Ç—ñ–Ω–¥—ñ –æ—Ä—Ç–∞“ì–∞ —Å–∞–ª—É
                ctx.fillText(label, DISPLAY_WIDTH / 2, DISPLAY_HEIGHT / 2);
            }
        }
        
        // –ë–∞—Å—Ç–∞–ø“õ—ã –º”ô—Ç—ñ–Ω–¥—ñ —Å–∞–ª—É
        drawPlaceholderText();

        function getPos(e) {
            const rect = canvas.getBoundingClientRect(); 

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            return {
                x: (clientX - rect.left) / rect.width * DISPLAY_WIDTH,
                y: (clientY - rect.top) / rect.height * DISPLAY_HEIGHT
            };
        }

        const startDraw = (e) => {
            isDrawing = true;
            ctx.clearRect(0, 0, DISPLAY_WIDTH, DISPLAY_HEIGHT); 

            ctx.beginPath();
            const pos = getPos(e);
            ctx.moveTo(pos.x, pos.y);
            e.preventDefault(); 
        };

        const draw = (e) => {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            e.preventDefault();
        };

        const endDraw = () => { isDrawing = false; };

        // –û“õ–∏“ì–∞–ª–∞—Ä–¥—ã —Ç—ñ—Ä–∫–µ—É
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('mouseout', endDraw);
        canvas.addEventListener('touchstart', startDraw);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', endDraw);

        clearBtn.addEventListener('click', () => {
            ctx.clearRect(0, 0, DISPLAY_WIDTH, DISPLAY_HEIGHT);
            drawPlaceholderText(); // –¢–∞–∑–∞–ª–∞“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω placeholder –º”ô—Ç—ñ–Ω—ñ–Ω “õ–∞–π—Ç–∞ —Å–∞–ª—É
        });
        
        // “ö–æ–ª “õ–æ—é –∞—è“õ—Ç–∞–ª“ì–∞–Ω–¥–∞ –¥–∞—É—ã—Å—Ç—ã —Ç–∞“£–¥–∞—É–¥—ã ”©“£–¥–µ—É–¥—ñ “õ–æ—Å—É
        canvas.addEventListener('mouseup', handleVoteSelection);
        canvas.addEventListener('touchend', handleVoteSelection);
    }
    
    /**
     * “ö–æ–ª “õ–æ–π—ã–ª“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω –±–∞—Å“õ–∞ –æ–ø—Ü–∏—è–ª–∞—Ä–¥—ã —Ç–∞–∑–∞—Ä—Ç–∞–¥—ã (–±—ñ—Ä —Å“±—Ä–∞“õ “Ø—à—ñ–Ω –±—ñ—Ä “ì–∞–Ω–∞ –¥–∞—É—ã—Å).
     */
    function handleVoteSelection(e) {
        const candidateBlock = e.currentTarget.closest('.candidate-block');
        
        if (!candidateBlock) return; 

        const siblingCanvases = candidateBlock.querySelectorAll('canvas');
        
        const currentCanvas = e.currentTarget;
        
        if (!isCanvasBlank(currentCanvas)) {
            siblingCanvases.forEach(cvs => {
                if (cvs !== currentCanvas) {
                    const clearBtn = cvs.parentNode.querySelector('.btn-clear');
                    setupCanvas(cvs, clearBtn); 
                }
            });
        }
    }


    // –ë–∞—Ä–ª—ã“õ canvas-—Ç–∞—Ä–¥—ã –æ—Ä–Ω–∞—Ç—É
    canvases.forEach(canvas => {
        const clearBtn = canvas.parentNode.querySelector('.btn-clear');
        setupCanvas(canvas, clearBtn);
    });

// ----------------------------------------------------------------------------------
// --- –ñ—ñ–±–µ—Ä—É –ª–æ–≥–∏–∫–∞—Å—ã ---

    document.getElementById('send-btn').addEventListener('click', async () => {
        const fullNameInput = document.getElementById('full-name');
        const fullName = fullNameInput.value.trim();

        if (!fullName) {
            statusMsg.style.color = "#e74c3c";
            statusMsg.innerText = "‚ùå –ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑–¥—ñ, –ø”ô—Ç–µ—Ä ‚Ññ, —Ç–µ–ª–µ—Ñ–æ–Ω –∂”ô–Ω–µ email-–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑!";
            return;
        }

        let hasSigned = false;
        canvases.forEach(cvs => {
            if (!isCanvasBlank(cvs)) {
                hasSigned = true;
            }
        });

        if (!hasSigned) {
            statusMsg.style.color = "#e74c3c";
            statusMsg.innerText = "‚ùå –ö–µ–º –¥–µ–≥–µ–Ω–¥–µ –±—ñ—Ä —Å“±—Ä–∞“õ“õ–∞ “õ–æ–ª “õ–æ—é “õ–∞–∂–µ—Ç.";
            return;
        }

        const maxRetries = 3; 

        async function attemptSend() {
            statusMsg.style.color = "#3498db";
            statusMsg.innerText = "‚è≥ –ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ...";

            const dataByQuestion = {
                '1': '“Æ–∏ –∫–µ“£–µ—Å—ñ –º“Ø—à–µ–ª–µ—Ä—ñ–Ω —Å–∞–∏–ª–∞—É:',
                '2': '–ë–∞“õ—ã–ª–∞—É—à—ã —Ä–µ–≤–∏–∑–æ—Ä —Å–∞–∏–ª–∞—É:',
                '3': '–ú–Ü–ë —Ç”©—Ä–∞“ì–∞—Å—ã–Ω —Å–∞–∏–ª–∞—É:'
            };
            
            const signedVotes = [];
            
            // --- 1. –¢–µ–∫ “õ–æ–ª “õ–æ–π—ã–ª“ì–∞–Ω –¥–∞—É—ã—Å—Ç–∞—Ä–¥—ã –∂–∏–Ω–∞—É ---
            canvases.forEach(cvs => {
                const label = cvs.getAttribute('data-label'); 
                const questionNumber = label.charAt(0);

                if (!isCanvasBlank(cvs)) {
                    // *** JPEG-–≥–µ –∞—É—ã—Å—Ç—ã—Ä—É –∂”ô–Ω–µ —Å–∞–ø–∞–Ω—ã –æ–¥–∞–Ω ”ô—Ä—ñ —Ç”©–º–µ–Ω–¥–µ—Ç—É (0.2-–≥–µ) ***
                    const dataURL = cvs.toDataURL('image/jpeg', 0.2); 
                    
                    signedVotes.push({
                        qNum: questionNumber,
                        label: label,
                        dataURL: dataURL
                    });
                }
            });
            
            // --- 2. Email Body “õ“±—Ä—É ---
            let emailBody = `<h3>“ö–∞—Ç—ã—Å—É—à—ã: ${fullName}</h3><hr>`;

            // –°“±—Ä–∞“õ—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ –¥–∞—É—ã—Å—Ç–∞—Ä–¥—ã —Ç–æ–ø—Ç–∞—Å—Ç—ã—Ä—É
            for (const qNum in dataByQuestion) {
                const votesForQuestion = signedVotes.filter(vote => vote.qNum === qNum);

                if (votesForQuestion.length > 0) {
                    emailBody += `<h4>${qNum}. ${dataByQuestion[qNum]}</h4><ul>`;
                    
                    votesForQuestion.forEach(vote => {
                        emailBody += `
                            <li>
                                <strong>–î–∞—É—ã—Å:</strong> ${vote.label}<br>
                                <strong>“ö–æ–ª—Ç–∞“£–±–∞:</strong> <img src="${vote.dataURL}" alt="“ö–æ–ª—Ç–∞“£–±–∞" style="max-width:120px; height:auto; border:1px solid #ccc;"><br><br>
                            </li>
                        `;
                    });
                    emailBody += `</ul>`;
                }
            }
            
            // --- 3. –ñ—ñ–±–µ—Ä—É ---
            const templateParams = {
                my_data: emailBody,
                full_name: fullName
            };

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    await emailjs.send('service_0mczhxj', 'template_t4xdvyl', templateParams);
                    statusMsg.style.color = "#27ae60";
                    statusMsg.innerText = "‚úÖ –°”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ! –†–∞—Ö–º–µ—Ç.";
                    return true; 
                } catch (err) {
                    console.error("–ñ—ñ–±–µ—Ä—É “õ–∞—Ç–µ—Å—ñ:", err);
                    statusMsg.style.color = "#f39c12";
                    statusMsg.innerText = `‚ö†Ô∏è –ñ—ñ–±–µ—Ä—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ. “ö–∞–π—Ç–∞–ª–∞—É–¥–∞... (${attempt + 1}/${maxRetries})`;
                    await new Promise(resolve => setTimeout(resolve, 1000 * (attempt + 1))); 
                }
            }
            
            statusMsg.style.color = "#e74c3c";
            statusMsg.innerText = "‚ùå –ñ—ñ–±–µ—Ä—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –ö–µ–π—ñ–Ω—ñ—Ä–µ–∫ “õ–∞–π—Ç–∞–ª–∞–ø –∫”©—Ä—ñ“£—ñ–∑.";
            return false;
        }

        await attemptSend();
    });
</script>


</body>
</html>
