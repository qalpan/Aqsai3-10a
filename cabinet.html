<script type="text/javascript">
// --- 1. –ë–∞—Å—Ç–∞–ø“õ—ã —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä (“ö–æ—Ä“ì–∞—É) ---
document.ondragstart = test;
document.onselectstart = test;
document.oncontextmenu = test;
function test(){return false}

// --- 2. –¢”©–ª–µ–º –î–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –ñ“Ø–∫—Ç–µ—É –∂”ô–Ω–µ –ö”©—Ä—Å–µ—Ç—É ---

// –§–∞–π–ª –∂–æ–ª—ã.
const paymentDataUrl = 'payments.json'; // –ï–≥–µ—Ä “õ–∞—Ç–µ —à—ã“õ—Å–∞, '/Aqsai3-10a/payments.json' –µ—Ç—ñ–ø ”©–∑–≥–µ—Ä—Ç—ñ“£—ñ–∑.

const container = document.getElementById('payment-table-container');
const statusMessage = document.getElementById('data-status');
const apartmentInput = document.getElementById('apartment-input');

// Enter –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω –±–∞—Å—É –∞—Ä“õ—ã–ª—ã –∂“Ø–∫—Ç–µ—É
apartmentInput.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        loadPaymentData();
    }
});

function loadPaymentData() {
    // 1. –ï–Ω–≥—ñ–∑—ñ–ª–≥–µ–Ω –º”ô–Ω–¥—ñ —Ç–∞–∑–∞–ª–∞—É –∂”ô–Ω–µ string (–∂–æ–ª) —Ñ–æ—Ä–º–∞—Ç—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É
    // –ë—ñ–∑ apartment-config.json-–¥–∞“ì—ã –º”ô–Ω–¥–µ—Ä–¥—ñ string –¥–µ–ø –µ—Å–µ–ø—Ç–µ–π–º—ñ–∑
    const targetApartment = apartmentInput.value.trim().toString(); 

    // 2. –ê–ª“ì–∞—à“õ—ã “õ–∞—Ç–µ–ª—ñ–∫ —Ç–µ–∫—Å–µ—Ä—É
    // –ï–≥–µ—Ä –±–æ—Å –±–æ–ª—Å–∞ –Ω–µ–º–µ—Å–µ 0-–¥–µ–Ω –∫—ñ—à—ñ –º”ô–Ω –±–æ–ª—Å–∞ “ì–∞–Ω–∞ “õ–∞—Ç–µ —à—ã“ì–∞—Ä–∞–º—ã–∑
    if (!targetApartment || targetApartment === '0') {
        statusMessage.innerHTML = '<span style="color: red; font-weight: bold;">–ü”ô—Ç–µ—Ä –Ω”©–º—ñ—Ä—ñ–Ω –¥“±—Ä—ã—Å –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.</span>';
        container.innerHTML = '<p>–ö–µ—Å—Ç–µ–Ω—ñ –∫”©—Ä—É “Ø—à—ñ–Ω –ø”ô—Ç–µ—Ä –Ω”©–º—ñ—Ä—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.</p>';
        return;
    }

    container.innerHTML = '<p>–î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ, –∫“Ø—Ç—ñ“£—ñ–∑...</p>';
    statusMessage.innerHTML = `–ü”ô—Ç–µ—Ä ${targetApartment} –±–æ–π—ã–Ω—à–∞ –¥–µ—Ä–µ–∫—Ç–µ—Ä —ñ–∑–¥–µ–ª—É–¥–µ...`;

    fetch(paymentDataUrl) 
        .then(response => {
            // üõë –ú–ê“¢–´–ó–î–´ –¢“Æ–ó–ï–¢–£: response.status —Ç–µ–∫—Å–µ—Ä—É–¥–µ–≥—ñ –ª–æ–≥–∏–∫–∞–ª—ã“õ “õ–∞—Ç–µ–Ω—ñ —Ç“Ø–∑–µ—Ç–µ–º—ñ–∑.
            if (!response.ok) { // response.ok == true, –µ–≥–µ—Ä —Å—Ç–∞—Ç—É—Å 200-299 –∞—Ä–∞–ª—ã“ì—ã–Ω–¥–∞ –±–æ–ª—Å–∞.
                // HTTP “õ–∞—Ç–µ—Å—ñ (–º—ã—Å–∞–ª—ã 404, 500)
                throw new Error(`HTTP “õ–∞—Ç–µ—Å—ñ! –°—Ç–∞—Ç—É—Å: ${response.status}. JSON —Ñ–∞–π–ª—ã–Ω –∂“Ø–∫—Ç–µ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.`);
            }
            return response.json();
        })
        .then(data => {
            // –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Å“Ø–∑—É
            // –ü”ô—Ç–µ—Ä –Ω”©–º—ñ—Ä—ñ —Ç–æ–ª—ã“ì—ã–º–µ–Ω —Å”ô–π–∫–µ—Å –∫–µ–ª—É—ñ –∫–µ—Ä–µ–∫
            const filteredData = data.filter(p => p.apartment === targetApartment).reverse(); 
            
            if (filteredData.length === 0) {
                 // –ï–≥–µ—Ä payments.json —ñ—à—ñ–Ω–¥–µ —Å”ô–π–∫–µ—Å –¥–µ—Ä–µ–∫—Ç–µ—Ä –±–æ–ª–º–∞—Å–∞
                 statusMessage.innerHTML = `<span style="color: blue; font-weight: bold;">–ü”ô—Ç–µ—Ä ${targetApartment} “Ø—à—ñ–Ω —Ç”©–ª–µ–º —Ç–∞—Ä–∏—Ö—ã —Ç–∞–±—ã–ª–º–∞–¥—ã.</span>`;
                 container.innerHTML = `<p><strong>${targetApartment}</strong> –ø”ô—Ç–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞ —Ç–∞–±—ã–ª“ì–∞–Ω –∂–∞–∑–±–∞–ª–∞—Ä –∂–æ“õ. –ï–Ω–≥—ñ–∑–≥–µ–Ω –Ω”©–º—ñ—Ä—ñ“£—ñ–∑–¥—ñ —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.</p>`;
                 return;
            }

            statusMessage.innerHTML = `<span style="color: green; font-weight: bold;">${filteredData.length} –∂–∞–∑–±–∞ —Ç–∞–±—ã–ª–¥—ã.</span>`;

            // –ö–µ—Å—Ç–µ–Ω—ñ “õ“±—Ä—É
            let html = `
                <h3>–ü”ô—Ç–µ—Ä ${targetApartment} –±–æ–π—ã–Ω—à–∞ —Ç”©–ª–µ–º —Ç–∞—Ä–∏—Ö—ã</h3>
                <table class="payment-history-table">
                    <thead>
                        <tr>
                            <th>–ê–π</th>
                            <th>–°–æ–º–∞—Å—ã (—Ç–≥)</th>
                            <th>–ú”ô—Ä—Ç–µ–±–µ—Å—ñ</th>
                            <th>–¢“Ø–±—ñ—Ä—Ç–µ–∫</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredData.forEach(payment => {
                const statusClass = payment.status === '–¢”©–ª–µ–Ω–¥—ñ' ? 'status-paid' : 'status-pending';
                const statusText = payment.status;
                const amountFormatted = (payment.amount || 0).toLocaleString('kk-KZ');

                html += `
                    <tr>
                        <td>${payment.month}</td>
                        <td style="text-align: right;">${amountFormatted}</td>
                        <td class="${statusClass}">${statusText}</td>
                        <td style="text-align: center;">${payment.receipt_link ? '<a href="' + payment.receipt_link + '" target="_blank">–¢“Ø–±—ñ—Ä—Ç–µ–∫ –∫”©—Ä—É</a>' : '‚Äî'}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        })
        .catch(error => {
            console.error('–¢”©–ª–µ–º –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ:', error);
            statusMessage.innerHTML = '<span style="color: red; font-weight: bold;">–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ —à—ã“õ—Ç—ã.</span>';
            container.innerHTML = `<p style="color: red;">–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –ö–æ–Ω—Å–æ–ª—å–¥—ñ —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑. “ö–∞—Ç–µ: ${error.message}</p>`;
        });
}

// --- 3. –ê–∫–∫–æ—Ä–¥–µ–æ–Ω —Ñ—É–Ω–∫—Ü–∏—è—Å—ã (–°—ñ–∑–¥—ñ“£ –±–∞—Å—Ç–∞–ø“õ—ã –∫–æ–¥—ã“£—ã–∑) ---
const list = document.querySelectorAll('.list');
// ... (—Å—ñ–∑–¥—ñ“£ –±–∞—Å“õ–∞ JS –ª–æ–≥–∏–∫–∞“£—ã–∑)
</script>
